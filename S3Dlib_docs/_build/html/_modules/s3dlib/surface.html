
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>s3dlib.surface &#8212; s3dlibdoc 20.07.23 documentation</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/s3dlib.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../_static/s3dliblogo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>

<div style="background-color: white; text-align: left">
        
<a href="../../index.html"><img src="../../_static/s3dliblogo.png"></a>


<nav class="main-nav">
        <ul>
            <li><a href="../../inst_index.html">Installation</a></li>
            <li><a href="../../doc_index.html">Documentation</a></li>
            <li><a href="../../tutorials/index.html">Tutorials</a></li>
            <li><a href="../../examples/index.html">Examples</a></li>
            <li><a href="../../docs/index.html">API</a>&nbsp;</li>
        </ul>
</nav>


</div>







    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../search.html">search</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for s3dlib.surface</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) Frank Zaverl, Jr.</span>
<span class="c1"># See file LICENSE for license information.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A module for creating 3D surface objects and auxiliary functions.</span>
<span class="sd"> </span>
<span class="sd">A surface is a collection of faces with 3D vertices ordered using</span>
<span class="sd">the &#39;right hand rule&#39; to designate the &#39;outer&#39; surface normals.  All surface faces</span>
<span class="sd">are joined with a minimum of one adjacent face. Adjacent faces share two</span>
<span class="sd">common vertices.</span>

<span class="sd">Surface instantiation is primarily performed using the four subclasses that</span>
<span class="sd">have predefined surface topologies in native coordinates and triangular faces.</span>
<span class="sd">The surface object geometry and color are controlled through various</span>
<span class="sd">object methods in the &#39;Surface3DCollection&#39; base class.</span>
<span class="sd">Base class objects are created by addition of subclass surface objects to</span>
<span class="sd">form a single &#39;composite&#39; surface.</span>

<span class="sd">Primitive surface objects may be created from faces with 3, 4, or 5</span>
<span class="sd">edges using the  &#39;Surface3DCollection&#39; base class in</span>
<span class="sd">xyz native coordinates.</span>

<span class="sd">Objects are added to the mpl_toolkits.mplot3d.axes3d using</span>
<span class="sd">the Axes3D.add_collection3d() method.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># DevNotes:</span>
<span class="c1">#     0  FutDev: future development notes.</span>
<span class="c1">#     1. Needed to used self._facecolors instead of self.get_facecolor()</span>
<span class="c1">#        Need to look into this.</span>
<span class="c1">#     2. Edgecolor not taking the alpha for facecolors.  May need a</span>
<span class="c1">#        direct assignment.</span>
<span class="c1">#     3. Tests indicate 80-95% of exec. time for larger rez is spent on the</span>
<span class="c1">#        call to Collection.set_color().  May need a more direct approach?</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">image</span>

<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d.art3d</span> <span class="kn">import</span> <span class="n">Poly3DCollection</span><span class="p">,</span> <span class="n">Line3DCollection</span>

<span class="n">_MINRAD</span> <span class="o">=</span> <span class="mf">0.01</span>    <span class="c1"># in subclassed polar and spherical surface split basetypes.</span>
<span class="n">_MAXREZ</span> <span class="o">=</span> <span class="mi">8</span>       <span class="c1"># in subclass surfaces, maximum recursive triangulation.</span>


<div class="viewcode-block" id="Surface3DCollection"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection">[docs]</a><span class="k">class</span> <span class="nc">Surface3DCollection</span><span class="p">(</span><span class="n">Poly3DCollection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for 3D surfaces.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_ILLUM</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># defaut light direction, (cmap_normals, shade and hilite).</span>
    <span class="n">_DFT_ALR</span> <span class="o">=</span> <span class="mf">0.25</span>   <span class="c1"># default axis length ratio, head size to vector magnitude.</span>

<div class="viewcode-block" id="Surface3DCollection.triangulateBase"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.triangulateBase">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">triangulateBase</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">baseVcoor</span><span class="p">,</span><span class="n">baseFaceVertexIndices</span><span class="p">,</span> <span class="n">midVectFunc</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively subdivide a triangulated surface.</span>

<span class="sd">        Each recursion subdivides each surface face by four.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rez : integer, optional, default: 0</span>
<span class="sd">            Number of recursive subdivisions of the triangulated base faces.</span>
<span class="sd">            Rez values range from 0 to 7.</span>

<span class="sd">        baseVcoor : V x 3 float array</span>
<span class="sd">            An array of &#39;v&#39; number of xyz vertex coordinates.</span>

<span class="sd">        baseFaceVertextIndices : F x 3 int array</span>
<span class="sd">            An array of &#39;F&#39; number of face vertex indices.</span>

<span class="sd">        midVectFunc : function object</span>
<span class="sd">            A function that takes two xyz coordinate (list of 3)</span>
<span class="sd">            representing a surface face edge.  Returns one xyz coordinate</span>
<span class="sd">            at the bisection of the edge, mapped on the surface.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        indexObj : a dictionary of vertex indices, for a surface</span>
<span class="sd">            of F faces, E edges and V vertices.</span>
<span class="sd">            &#39;face&#39; : F x 3 int array</span>
<span class="sd">            &#39;edge&#39; : E x 2 int array</span>

<span class="sd">        vertCoor : V x 3 float array</span>
<span class="sd">            An array of V number of xyz vertex coordinates.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">vCoor</span> <span class="o">=</span> <span class="n">baseVcoor</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">fvIndices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">evIndices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#.....................................    </span>
        <span class="k">def</span> <span class="nf">getVerticesLine</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">leftIndex</span><span class="p">,</span> <span class="n">rightIndex</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">def</span> <span class="nf">recurs_edgeCoor</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">indexOrigin</span><span class="p">,</span> <span class="n">isRight</span><span class="p">,</span> <span class="n">leftIndex</span><span class="p">,</span> <span class="n">rightIndex</span><span class="p">,</span> <span class="n">Eindex</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">degree</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">m</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">isRight</span> <span class="p">:</span> <span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="n">delta</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">indexOrigin</span> <span class="o">-</span> <span class="n">delta</span>
                <span class="n">mid_coor</span> <span class="o">=</span> <span class="n">midVectFunc</span><span class="p">(</span> <span class="n">vCoor</span><span class="p">[</span><span class="n">leftIndex</span><span class="p">],</span> <span class="n">vCoor</span><span class="p">[</span><span class="n">rightIndex</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">currentCoorIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vCoor</span><span class="p">)</span>
                <span class="n">vCoor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mid_coor</span><span class="p">)</span>
                <span class="n">Eindex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentCoorIndex</span>
                <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">:</span>
                    <span class="n">evIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="n">leftIndex</span><span class="p">,</span> <span class="n">currentCoorIndex</span><span class="p">]</span> <span class="p">)</span>                    
                    <span class="n">evIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="n">currentCoorIndex</span><span class="p">,</span> <span class="n">rightIndex</span><span class="p">]</span> <span class="p">)</span>                    
                    <span class="k">return</span>
                <span class="n">recurs_edgeCoor</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="n">leftIndex</span><span class="p">,</span><span class="n">currentCoorIndex</span><span class="p">,</span> <span class="n">Eindex</span><span class="p">)</span>
                <span class="n">recurs_edgeCoor</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">currentCoorIndex</span><span class="p">,</span><span class="n">rightIndex</span><span class="p">,</span> <span class="n">Eindex</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="c1">#.....................................    </span>
            <span class="n">iOrigin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">degree</span><span class="p">))</span>
            <span class="n">Eindex</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">iOrigin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">Eindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">leftIndex</span>
            <span class="n">Eindex</span><span class="p">[</span><span class="n">iOrigin</span><span class="p">]</span> <span class="o">=</span> <span class="n">rightIndex</span>
            <span class="k">if</span> <span class="n">degree</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span>
                <span class="n">evIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="n">leftIndex</span><span class="p">,</span> <span class="n">rightIndex</span><span class="p">]</span> <span class="p">)</span>
                <span class="k">return</span> <span class="n">Eindex</span>
            <span class="n">recurs_edgeCoor</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">iOrigin</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">leftIndex</span><span class="p">,</span> <span class="n">rightIndex</span><span class="p">,</span> <span class="n">Eindex</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Eindex</span>
        <span class="c1">#.....................................    </span>
        <span class="k">def</span> <span class="nf">recurs_faceIndices</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">rez</span><span class="p">,</span><span class="n">atCenter</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rez</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span>
                <span class="n">abc</span> <span class="o">=</span> <span class="p">[</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>               
                <span class="n">fvIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">abc</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">atCenter</span> <span class="p">:</span> <span class="n">evIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span> <span class="p">)</span>
                <span class="k">return</span>
            <span class="c1"># construct the sub triangle edge vertices....</span>
            <span class="n">cIndex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span>
            <span class="n">cShift</span> <span class="o">=</span> <span class="n">cIndex</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">Ax</span> <span class="o">=</span> <span class="n">A</span><span class="p">[:</span><span class="n">cShift</span><span class="p">]</span>
            <span class="n">xB</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">cIndex</span><span class="p">:]</span>
            <span class="n">By</span> <span class="o">=</span> <span class="n">B</span><span class="p">[:</span><span class="n">cShift</span><span class="p">]</span>
            <span class="n">yC</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">cIndex</span><span class="p">:]</span>
            <span class="n">Cz</span> <span class="o">=</span> <span class="n">C</span><span class="p">[:</span><span class="n">cShift</span><span class="p">]</span>
            <span class="n">zA</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">cIndex</span><span class="p">:]</span>
            <span class="c1"># construct the center sub triangle edge vertices....</span>
            <span class="k">if</span> <span class="n">rez</span><span class="o">==</span><span class="mi">1</span> <span class="p">:</span>
                <span class="n">xz</span> <span class="o">=</span> <span class="p">[</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span>
                <span class="n">yx</span> <span class="o">=</span> <span class="p">[</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span>
                <span class="n">zy</span> <span class="o">=</span> <span class="p">[</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>               
                <span class="n">xz</span> <span class="o">=</span> <span class="n">getVerticesLine</span><span class="p">(</span><span class="n">rez</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">A</span><span class="p">[</span><span class="n">cIndex</span><span class="p">],</span> <span class="n">C</span><span class="p">[</span><span class="n">cIndex</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">yx</span> <span class="o">=</span> <span class="n">getVerticesLine</span><span class="p">(</span><span class="n">rez</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">B</span><span class="p">[</span><span class="n">cIndex</span><span class="p">],</span> <span class="n">A</span><span class="p">[</span><span class="n">cIndex</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">zy</span> <span class="o">=</span> <span class="n">getVerticesLine</span><span class="p">(</span><span class="n">rez</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="n">cIndex</span><span class="p">],</span> <span class="n">B</span><span class="p">[</span><span class="n">cIndex</span><span class="p">]</span> <span class="p">)</span>
            <span class="c1"># construct the 4 sub triangles...</span>
            <span class="n">recurs_faceIndices</span><span class="p">(</span><span class="n">Ax</span><span class="p">,</span><span class="n">xz</span><span class="p">,</span><span class="n">zA</span><span class="p">,</span><span class="n">rez</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">recurs_faceIndices</span><span class="p">(</span><span class="n">By</span><span class="p">,</span><span class="n">yx</span><span class="p">,</span><span class="n">xB</span><span class="p">,</span><span class="n">rez</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">recurs_faceIndices</span><span class="p">(</span><span class="n">Cz</span><span class="p">,</span><span class="n">zy</span><span class="p">,</span><span class="n">yC</span><span class="p">,</span><span class="n">rez</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">recurs_faceIndices</span><span class="p">(</span><span class="n">yx</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">zy</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">xz</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">rez</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1">#.....................................</span>
        <span class="c1"># generate the base edge indices for each face </span>
        <span class="n">baseFaceEdgeIndices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">edgeArrayIndexMatrix</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vCoor</span><span class="p">))]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vCoor</span><span class="p">))]</span>   
        <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">baseFaceVertexIndices</span> <span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="p">[</span> <span class="n">face</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">face</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">B</span> <span class="o">=</span> <span class="p">[</span> <span class="n">face</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">face</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
            <span class="n">C</span> <span class="o">=</span> <span class="p">[</span> <span class="n">face</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">face</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">edgeIndices</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">]</span>
            <span class="n">baseFaceEdgeIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edgeIndices</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">vertexIndex</span> <span class="ow">in</span> <span class="n">edgeIndices</span> <span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">vertexIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">vertexIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">edgeArrayIndexMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">edgeArrayIndexMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">getVerticesLine</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="p">)</span>
                    <span class="n">edgeArrayIndexMatrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">edgeArrayIndexMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># trianglulate the base triangles</span>
        <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">baseFaceEdgeIndices</span> <span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">edgeArrayIndexMatrix</span><span class="p">[</span><span class="n">face</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="n">face</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">edgeArrayIndexMatrix</span><span class="p">[</span><span class="n">face</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="n">face</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">edgeArrayIndexMatrix</span><span class="p">[</span><span class="n">face</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="n">face</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">rez</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">recurs_faceIndices</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">rez</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">vertexCoor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vCoor</span><span class="p">)</span> 
        <span class="n">indexObj</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;face&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fvIndices</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;edge&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">evIndices</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">indexObj</span> <span class="p">,</span><span class="n">vertexCoor</span></div>

<div class="viewcode-block" id="Surface3DCollection.coor_convert"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.coor_convert">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coor_convert</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">tocart</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Coordinate transformation.</span>
<span class="sd">        </span>
<span class="sd">           To be overriden by any subclass not in Cartesian coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">xyz</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_map3Dto2Dsquare</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Map surface to rectangular unit coordinates (0,1).&quot;&quot;&quot;</span>

        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_sfev</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">fevArray</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Calculate number of surface faces, edges, vertices.&quot;&quot;&quot;</span>

        <span class="n">Fo</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Vx</span> <span class="o">=</span> <span class="n">fevArray</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">rez</span><span class="p">)</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">eta</span><span class="o">*</span><span class="n">eta</span><span class="o">*</span><span class="n">Fo</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span> <span class="mi">3</span><span class="o">*</span><span class="n">F</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">eta</span><span class="o">*</span><span class="n">phi</span> <span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span> <span class="n">F</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">eta</span><span class="o">*</span><span class="n">phi</span> <span class="o">+</span> <span class="n">Vx</span> <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">F</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">V</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_fev</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">rez</span><span class="p">,</span><span class="n">basetype</span><span class="p">,</span><span class="n">dercls</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sets up _sfev method, based on calls from the subclass dercls.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">rez</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">rez</span><span class="o">&gt;</span><span class="n">_MAXREZ</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrest rez of </span><span class="si">{}</span><span class="s1">, must be an int, 0 &lt;= rez &lt;= </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">_MAXREZ</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">basetype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">basetype</span> <span class="o">=</span> <span class="n">dercls</span><span class="o">.</span><span class="n">_default_base</span>
        <span class="n">basesurf</span> <span class="o">=</span> <span class="n">dercls</span><span class="o">.</span><span class="n">_base_surfaces</span>
        <span class="k">if</span> <span class="n">basetype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">basesurf</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Basetype </span><span class="si">{}</span><span class="s1"> is not recognized. Possible values are: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">basetype</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">basesurf</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_sfev</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span> <span class="n">basesurf</span><span class="p">[</span><span class="n">basetype</span><span class="p">][</span><span class="s1">&#39;fevParam&#39;</span><span class="p">]</span> <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_uvw_to_xyz</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">rst</span><span class="p">,</span><span class="n">abc</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Rotational transformation at a coordinate.</span>
<span class="sd">        </span>
<span class="sd">           To be overriden by any subclass not in Cartesian coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_disp_to_xyz</span><span class="p">(</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">uvw</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Rotational transformation from rotation angles.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">theta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">return</span> <span class="n">uvw</span>
        <span class="c1"># each set of uvw has a different rotation matrix</span>
        <span class="c1"># that must be evaluated one at a time.</span>
        <span class="k">if</span> <span class="n">phi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">uvwT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">uvw</span><span class="p">)</span>
        <span class="n">dispVect</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">rotMx</span> <span class="o">=</span> <span class="n">eulerRot</span><span class="p">(</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">inrad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">uvwT</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotMx</span> <span class="p">)</span>
            <span class="n">dispVect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dispVect</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertexCoor</span><span class="p">,</span> <span class="n">faceIndices</span><span class="p">,</span> <span class="n">edgeIndices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        3D surface of connected F faces, each face with N number of vertices.</span>
<span class="sd">        The surface has V number of vertices and E number of edges.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vertexCoor : V x 3 float numpy.ndarray </span>
<span class="sd">            An array of V number of xyz vertex coordinates.</span>

<span class="sd">        faceIndices : F x N int numpy.ndarray</span>
<span class="sd">            An array of F number of N face vertex indices.</span>

<span class="sd">        edgeIndices : E x 2 int numpy.ndarray, optional, default: None</span>
<span class="sd">            An array of E number of 2 edge vertex indices.</span>
<span class="sd">            If None is provided, the &#39;edges&#39; property is not available.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        *args, **kwargs</span>
<span class="sd">            All other arguments are passed on to mpl_toolkits.mplot3d.art3d.Poly3DCollection.</span>
<span class="sd">            Valid argument names include: color, edgecolors, facecolors, linewidths, cmap.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span> <span class="o">=</span> <span class="n">vertexCoor</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseVertexCoor</span> <span class="o">=</span> <span class="n">vertexCoor</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="o">=</span> <span class="n">faceIndices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evIndices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">edgeIndices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evIndices</span> <span class="o">=</span> <span class="n">edgeIndices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_surfaceShapeChanged</span> <span class="o">=</span> <span class="kc">False</span>       <span class="c1"># control flag for image operations      </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isCompositeSurface</span> <span class="o">=</span> <span class="kc">False</span>        <span class="c1"># control flag for a composite object.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_normal_scale</span> <span class="o">=</span> <span class="mf">1.0</span>                <span class="c1"># overridden in subclass default</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">restoredClip</span> <span class="o">=</span> <span class="kc">None</span>                <span class="c1"># dictionary to restore from clip operation.</span>

        <span class="c1"># following is used for map_geom_from_image().</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_Vector</span> <span class="o">=</span> <span class="kc">None</span>                 <span class="c1"># overridden in subclass.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vector_field</span> <span class="o">=</span> <span class="kc">None</span>                <span class="c1"># for vector fields when transformed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>                    <span class="c1"># for axis when transformed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translation</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>              <span class="c1"># for axis when transformed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>         <span class="c1"># for axis when transformed.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_geometric_bounds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="s1">&#39;vlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">]</span>       
    
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">othr</span><span class="p">)</span> <span class="p">:</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">othr</span><span class="p">,</span> <span class="n">Surface3DCollection</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Add operations can only apply between Surface3DCollection objects.&#39;</span><span class="p">)</span>

        <span class="n">topVerCoor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="n">botVerCoor</span> <span class="o">=</span> <span class="n">othr</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="n">totVerCoor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topVerCoor</span><span class="p">,</span><span class="n">botVerCoor</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">nextIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">topVerCoor</span><span class="p">)</span>

        <span class="n">topFVindices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span>
        <span class="n">botFVindices</span> <span class="o">=</span> <span class="n">othr</span><span class="o">.</span><span class="n">fvIndices</span>
        <span class="n">FVtail</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">botFVindices</span><span class="p">,</span><span class="n">nextIndex</span><span class="p">)</span>
        <span class="n">totFVindices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topFVindices</span><span class="p">,</span><span class="n">FVtail</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">topEVindices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evIndices</span>
        <span class="n">botEVindices</span> <span class="o">=</span> <span class="n">othr</span><span class="o">.</span><span class="n">evIndices</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">topEVindices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">botEVindices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">totEVindices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">EVtail</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">botEVindices</span><span class="p">,</span><span class="n">nextIndex</span><span class="p">)</span>
            <span class="n">totEVindices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topEVindices</span><span class="p">,</span><span class="n">EVtail</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">Surface3DCollection</span><span class="p">(</span><span class="n">totVerCoor</span><span class="p">,</span><span class="n">totFVindices</span><span class="p">,</span><span class="n">totEVindices</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_isCompositeSurface</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="n">top_onearr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">topFVindices</span><span class="p">)</span> <span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">top_orig_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facecolors</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_orig_colors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">top_orig_colors</span> <span class="o">=</span> <span class="n">top_orig_colors</span><span class="o">*</span><span class="n">top_onearr</span>

        <span class="n">bot_onearr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">botFVindices</span><span class="p">)</span> <span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">bot_orig_colors</span> <span class="o">=</span> <span class="n">othr</span><span class="o">.</span><span class="n">_facecolors</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bot_orig_colors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">bot_orig_colors</span> <span class="o">=</span> <span class="n">bot_orig_colors</span><span class="o">*</span><span class="n">bot_onearr</span>

        <span class="n">total_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">top_orig_colors</span><span class="p">,</span><span class="n">bot_orig_colors</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">total_colors</span><span class="p">)</span>        

        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="c1"># parent class doesn&#39;t have specific properties...</span>
        <span class="k">try</span><span class="p">:</span>     <span class="n">bs</span> <span class="o">=</span> <span class="s1">&#39; ( </span><span class="si">{}</span><span class="s1"> , </span><span class="si">{}</span><span class="s1"> )&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rez</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_basetype</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>  <span class="n">bs</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="n">numFaces</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span><span class="p">)</span>
        <span class="n">numVerts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">sz</span> <span class="o">=</span> <span class="s1">&#39;:  faces: </span><span class="si">{}</span><span class="s1">,  vertices: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numFaces</span><span class="p">,</span><span class="n">numVerts</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">name</span><span class="o">+</span><span class="n">bs</span><span class="o">+</span><span class="n">sz</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_tranformVector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orgCoor</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">returnxyz</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Functional tranformation of coordinates.&quot;&quot;&quot;</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">orgCoor</span><span class="p">)</span>
        <span class="n">abc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coor_convert</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">operation</span><span class="p">(</span><span class="n">abc</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">returnxyz</span> <span class="p">:</span> <span class="n">XYZ</span> <span class="o">=</span> <span class="n">rst</span>
        <span class="k">else</span> <span class="p">:</span>         <span class="n">XYZ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coor_convert</span><span class="p">(</span> <span class="n">rst</span> <span class="p">,</span> <span class="n">tocart</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">XYZ</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_vectorfield_Line3DCollection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_field</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alr</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Vector3DCollection at surface vertices.&quot;&quot;&quot;</span>       
        <span class="k">if</span> <span class="n">alr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">alr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DFT_ALR</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vector_field</span> <span class="o">=</span> <span class="n">vector_field</span>
        <span class="n">lcol</span> <span class="o">=</span> <span class="n">Vector3DCollection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">,</span><span class="n">vector_field</span><span class="p">,</span><span class="n">alr</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lcol</span>

    <span class="k">def</span> <span class="nf">_get_face_normals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">faceCoor</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Unit normals of triangular face coordinates.&quot;&quot;&quot;</span>
        <span class="n">vfT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">faceCoor</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">vAB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span> <span class="n">vfT</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vfT</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="p">)</span>
        <span class="n">vAC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span> <span class="n">vfT</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vfT</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="p">)</span>
        <span class="n">vABt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">vAB</span><span class="p">)</span>
        <span class="n">vACt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">vAC</span><span class="p">)</span>
        <span class="n">cross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vABt</span><span class="p">,</span><span class="n">vACt</span><span class="p">)</span>
        <span class="n">sz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">cross</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">cross</span><span class="p">,</span><span class="n">sz</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_face_centers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">faceCoor</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Face centers of traiangular face coordinates.&quot;&quot;&quot;</span>
        <span class="n">vfT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">faceCoor</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">numVerts</span> <span class="o">=</span> <span class="n">vfT</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sumV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vfT</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sumV</span><span class="p">)</span><span class="o">/</span><span class="n">numVerts</span>

    <span class="k">def</span> <span class="nf">_set_geometric_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Set _bounds dictionary values from the surface vertex coordinates.&quot;&quot;&quot;</span>

        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="p">,</span><span class="n">zlim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">v</span> <span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">v</span> <span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zlim</span>
        <span class="n">rmax_xy</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">rmin_xy</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="s1">&#39;r_xy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rmin_xy</span><span class="p">,</span> <span class="n">rmax_xy</span> <span class="p">]</span> 
        <span class="n">rmax_xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">rmin_xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="s1">&#39;rorg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rmin_xyz</span><span class="p">,</span> <span class="n">rmax_xyz</span> <span class="p">]</span> 
        <span class="c1"># vestigal...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="s1">&#39;rlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rmax_xy</span><span class="p">,</span> <span class="n">rmax_xyz</span> <span class="p">]</span>
        <span class="k">return</span>    

    <span class="k">def</span> <span class="nf">_viewportCoor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xyzCoor</span><span class="p">,</span><span class="n">viewport</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">xyzCoor</span><span class="p">)</span>
        <span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map3Dto2Dsquare</span><span class="p">(</span> <span class="n">xyz</span> <span class="p">)</span>
        <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">ab</span>
        <span class="k">if</span> <span class="n">viewport</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">return</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">As</span><span class="p">,</span><span class="n">Bs</span><span class="p">,</span><span class="n">Ae</span><span class="p">,</span><span class="n">Be</span> <span class="o">=</span> <span class="n">viewport</span>
        <span class="n">Aref</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">As</span>
        <span class="n">Bref</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">Bs</span>
        <span class="n">Adelta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">Ae</span><span class="o">+</span><span class="n">Aref</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">Bdelta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">Be</span><span class="o">+</span><span class="n">Bref</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Adelta</span> <span class="o">&lt;=</span><span class="mf">0.0</span> <span class="p">:</span> <span class="n">Adelta</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">Bdelta</span> <span class="o">&lt;=</span><span class="mf">0.0</span> <span class="p">:</span> <span class="n">Bdelta</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">Ap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">Aref</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">Bp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">Bref</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">Av</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">Ap</span><span class="p">,</span><span class="n">Adelta</span><span class="p">)</span>
        <span class="n">Bv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">Bp</span><span class="p">,</span><span class="n">Bdelta</span><span class="p">)</span>
        <span class="n">inViewport</span> <span class="o">=</span> <span class="n">Av</span><span class="o">&lt;=</span><span class="mi">1</span>
        <span class="n">inViewport</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Bv</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inViewport</span><span class="p">),</span><span class="kc">False</span><span class="p">),</span><span class="n">inViewport</span><span class="p">)</span>
        <span class="n">Av</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">Av</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">Bv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">Bv</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Av</span><span class="p">,</span><span class="n">Bv</span><span class="p">,</span><span class="n">inViewport</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary of surface geometric and value ranges.</span>
<span class="sd">        </span>
<span class="sd">        Each dictionary value is a 2 float array of minimum</span>
<span class="sd">        and maximum values of the surface.  Keys are:</span>

<span class="sd">            &#39;xlim&#39; : x-coordinate</span>
<span class="sd">            &#39;ylim&#39; : y-coordinate</span>
<span class="sd">            &#39;zlim&#39; : z-coordinate</span>
<span class="sd">            &#39;r_xy&#39; : radial distance from the z axis</span>
<span class="sd">            &#39;rorg&#39; : radial distance from the origin</span>
<span class="sd">            &#39;vlim&#39; : value functional assignments.</span>
<span class="sd">            </span>
<span class="sd">        Values are assigned using datagrid and color mapping methods.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cBar_ScalarMappable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;matplotlib.cm.ScalarMappable object for surface values.&quot;&quot;&quot;</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="s1">&#39;vlim&#39;</span><span class="p">]</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">objMap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">()</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">objMap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
        <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
        <span class="k">return</span> <span class="n">sm</span>        
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;Line3DCollection of the triangulated surface edges.&#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evIndices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No Edge Indices argument during the Surface3DCollection object instantiation.&#39;</span><span class="p">)</span>       
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evIndices</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="n">lcol</span> <span class="o">=</span> <span class="n">Line3DCollection</span><span class="p">(</span> <span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">lcol</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;A 3 x N array of surface vertices.&quot;&quot;&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">facecenters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;A 3 x N array of surface face center coordinates.&quot;&quot;&quot;</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="p">]</span>
        <span class="n">faceCenterCoor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_centers</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">faceCenterCoor</span><span class="p">)</span>
        <span class="k">return</span>  <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>       
    
<div class="viewcode-block" id="Surface3DCollection.triangulate"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.triangulate">[docs]</a>    <span class="k">def</span> <span class="nf">triangulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rez</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Planar subdivision of each face into triangular faces.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rez : integer, optional, default: 0</span>
<span class="sd">            Number of recursive subdivisions of the base faces</span>
<span class="sd">            into triangular faces, four faces per rez.</span>
<span class="sd">            Rez values range from 0 to 7.</span>
<span class="sd">            For surfaces with 4 vertices per face, each face is first</span>
<span class="sd">            subdivided into two faces, then recursion proceeds.</span>
<span class="sd">            For surfaces with 5 vertices per face, each face is first</span>
<span class="sd">            subdivided into three faces, then recursion proceeds.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : surface object</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># .............................................................</span>
        <span class="k">def</span> <span class="nf">divideFace4</span><span class="p">(</span><span class="n">face</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">dist_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="n">face</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="n">face</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="p">)</span>
            <span class="n">dist_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="n">face</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="n">face</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">dist_a</span> <span class="o">&lt;</span> <span class="n">dist_b</span> <span class="p">:</span>
                <span class="n">face1</span> <span class="o">=</span> <span class="p">[</span> <span class="n">face</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">face</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">face</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">]</span>
                <span class="n">face2</span> <span class="o">=</span> <span class="p">[</span> <span class="n">face</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">face</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">face</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">face1</span> <span class="o">=</span> <span class="p">[</span> <span class="n">face</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">face</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">face</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">]</span>
                <span class="n">face2</span> <span class="o">=</span> <span class="p">[</span> <span class="n">face</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">face</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">face</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span>               
            <span class="k">return</span> <span class="n">face1</span><span class="p">,</span> <span class="n">face2</span>
        <span class="c1"># .............................................................</span>
        <span class="k">def</span> <span class="nf">divideFace5</span><span class="p">(</span><span class="n">face</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">diag</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="n">face</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span> <span class="p">]</span>
            <span class="n">fc3</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span> <span class="p">:</span> <span class="p">[</span> <span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">face</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">],</span> <span class="n">face</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span> <span class="p">]</span>
            <span class="n">fc4</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span> <span class="p">:</span> <span class="p">[</span> <span class="n">face</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">],</span> <span class="n">face</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">],</span> <span class="n">face</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">],</span> <span class="n">face</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">]</span> <span class="p">]</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">:</span> <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span> <span class="n">diag</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">minDiag</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">minDiag</span><span class="p">]</span> <span class="p">:</span> <span class="n">minDiag</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">face1</span> <span class="o">=</span> <span class="n">fc3</span><span class="p">(</span><span class="n">minDiag</span><span class="p">)</span>
            <span class="n">otherFace</span> <span class="o">=</span> <span class="n">fc4</span><span class="p">(</span><span class="n">minDiag</span><span class="p">)</span>
            <span class="n">face2</span><span class="p">,</span> <span class="n">face3</span> <span class="o">=</span> <span class="n">divideFace4</span><span class="p">(</span><span class="n">otherFace</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">face1</span><span class="p">,</span> <span class="n">face2</span><span class="p">,</span> <span class="n">face3</span>
        <span class="c1"># .............................................................</span>
        <span class="k">def</span> <span class="nf">midVFun</span><span class="p">(</span><span class="n">vectA</span><span class="p">,</span> <span class="n">vectB</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vectA</span><span class="p">,</span><span class="n">vectB</span><span class="p">)</span>
            <span class="n">mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="n">mid</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mid</span>       
        <span class="c1"># .............................................................</span>
        <span class="c1"># FutDev: major need to optimize efficiency</span>
        <span class="n">subFaceIndices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">face</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">:</span>
                    <span class="n">subFaceIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">face</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">:</span>
                    <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">divideFace4</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
                    <span class="n">subFaceIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
                    <span class="n">subFaceIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">face</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span> <span class="p">:</span>
                    <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span> <span class="o">=</span> <span class="n">divideFace5</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
                    <span class="n">subFaceIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
                    <span class="n">subFaceIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>
                    <span class="n">subFaceIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">subFaceIndices</span><span class="p">)</span>

        <span class="n">indexObj</span> <span class="p">,</span><span class="n">vertexCoor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangulateBase</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span><span class="p">,</span> <span class="n">midVFun</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="o">=</span> <span class="n">indexObj</span><span class="p">[</span><span class="s1">&#39;face&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evIndices</span> <span class="o">=</span> <span class="n">indexObj</span><span class="p">[</span><span class="s1">&#39;edge&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span> <span class="o">=</span> <span class="n">vertexCoor</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_verts</span><span class="p">(</span> <span class="n">verts</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_geometric_bounds</span><span class="p">()</span>
        
        <span class="n">c</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;patch.facecolor&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">colorArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">c</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span> <span class="n">colorArr</span>  <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>        </div>

<div class="viewcode-block" id="Surface3DCollection.normalize_scale"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.normalize_scale">[docs]</a>    <span class="k">def</span> <span class="nf">normalize_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Scaling normalization array and reciprocal.&quot;&quot;&quot;</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">scX</span> <span class="o">=</span> <span class="p">(</span> <span class="n">bounds</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bounds</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="p">)</span>
        <span class="n">scY</span> <span class="o">=</span> <span class="p">(</span> <span class="n">bounds</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bounds</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="p">)</span>
        <span class="n">scZ</span> <span class="o">=</span> <span class="p">(</span> <span class="n">bounds</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bounds</span><span class="p">[</span><span class="s1">&#39;zlim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="p">)</span>
        <span class="n">recip</span> <span class="o">=</span> <span class="p">[</span><span class="n">scX</span><span class="p">,</span><span class="n">scY</span><span class="p">,</span><span class="n">scZ</span><span class="p">]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span><span class="n">recip</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scale</span><span class="p">,</span> <span class="n">recip</span></div>

<div class="viewcode-block" id="Surface3DCollection.facenormals"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.facenormals">[docs]</a>    <span class="k">def</span> <span class="nf">facenormals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alr</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Vector3DCollection of scaled face normals at face centers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        scale: number, optional</span>
<span class="sd">            If not spectified, scaled proportional to the mean edge</span>
<span class="sd">            length of surface base faces.</span>

<span class="sd">        color : str or float list of length 3 or 4.</span>
<span class="sd">            RGB or RGBA color, either a Matplotlib format string or a </span>
<span class="sd">            list of color values in range [0,1].</span>
<span class="sd">        </span>
<span class="sd">        width : number, optional, default: 1</span>
<span class="sd">            Line width of the vector.</span>

<span class="sd">        alr : scalar, optional, default: 0.25</span>
<span class="sd">            Axis length ratio, head size to vector magnitude.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Vector3DCollection object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">alr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">alr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DFT_ALR</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normal_scale</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="p">]</span>
        <span class="n">faceCenterCoor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_centers</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="n">faceNormalCoor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_normals</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="n">lcol</span> <span class="o">=</span> <span class="n">Vector3DCollection</span><span class="p">(</span><span class="n">faceCenterCoor</span><span class="p">,</span><span class="n">faceNormalCoor</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span><span class="n">alr</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lcol</span></div>

<div class="viewcode-block" id="Surface3DCollection.dispfield_from_op"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.dispfield_from_op">[docs]</a>    <span class="k">def</span> <span class="nf">dispfield_from_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">returnxyz</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">useBase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alr</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Vector3DCollection of displacement of vertices to a different position.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        operation : function object</span>
<span class="sd">            Function that takes one coordinate</span>
<span class="sd">            argument, a 3xN Numpy array.</span>
<span class="sd">            The function returns a 3xN array of vectors.</span>
<span class="sd">        </span>
<span class="sd">        returnxyz : bool { True, False }, optional, default: False</span>
<span class="sd">            By default, native coordinates are returned by the</span>
<span class="sd">            operation function.  If set True, the operation</span>
<span class="sd">            returns xyz Cartesian coordinates.</span>

<span class="sd">        useBase : bool { True, False }, optional, default: False</span>
<span class="sd">            When set False, vertices of the surface, prior to</span>
<span class="sd">            any geometric mapping or transforms, are passed to</span>
<span class="sd">            the operation function.  Otherwise, when True, the</span>
<span class="sd">            current surface vertices are passed.</span>

<span class="sd">        scale: number, optional, default: 1.</span>

<span class="sd">        color : str or float list of length 3 or 4.</span>
<span class="sd">            RGB or RGBA color, either a Matplotlib format string or a </span>
<span class="sd">            list of color values in range [0,1].</span>
<span class="sd">        </span>
<span class="sd">        width : number, optional, default: 1</span>
<span class="sd">            Line width of the vector.</span>

<span class="sd">        alr : scalar, optional, default: 0.25</span>
<span class="sd">            Axis length ratio, head size to vector magnitude.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Vector3DCollection object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">alr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">alr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DFT_ALR</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isCompositeSurface</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Vector operation not available for combined shapes.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">start_coor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="k">if</span> <span class="n">useBase</span> <span class="p">:</span> <span class="n">start_coor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseVertexCoor</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tranformVector</span><span class="p">(</span><span class="n">start_coor</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">returnxyz</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">v</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">scale</span><span class="o">*</span><span class="n">delta</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vectorfield_Line3DCollection</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">alr</span><span class="p">)</span></div>

<div class="viewcode-block" id="Surface3DCollection.vectorfield_from_op"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.vectorfield_from_op">[docs]</a>    <span class="k">def</span> <span class="nf">vectorfield_from_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alr</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Vector3DCollection of vectors in u,v,w coordinates at surface vertices.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        operation : function object</span>
<span class="sd">            Function that takes one coordinate</span>
<span class="sd">            argument, a 3xN Numpy array of native coordinates.</span>
<span class="sd">            The function returns a 3xN array of vectors.</span>
<span class="sd">        </span>
<span class="sd">        scale: number, optional, default: 1.</span>

<span class="sd">        color : str or float list of length 3 or 4.</span>
<span class="sd">            RGB or RGBA color, either a Matplotlib format string or a </span>
<span class="sd">            list of color values in range [0,1].</span>
<span class="sd">        </span>
<span class="sd">        width : number, optional, default: 1</span>
<span class="sd">            Line width of the vector.</span>

<span class="sd">        alr : scalar, optional, default: 0.25</span>
<span class="sd">            Axis length ratio, head size to vector magnitude.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Vector3DCollection object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">alr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">alr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DFT_ALR</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isCompositeSurface</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Vector operation not available for combined shapes.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">)</span>
        <span class="n">abc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coor_convert</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="n">abc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">abc</span><span class="p">)</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">operation</span><span class="p">(</span><span class="n">abc</span><span class="p">))</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="n">scale</span><span class="o">*</span><span class="n">rst</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uvw_to_xyz</span><span class="p">(</span><span class="n">rst</span><span class="p">,</span><span class="n">abc</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vectorfield_Line3DCollection</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">alr</span><span class="p">)</span></div>

<div class="viewcode-block" id="Surface3DCollection.vectorfield_to_surface"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.vectorfield_to_surface">[docs]</a>    <span class="k">def</span> <span class="nf">vectorfield_to_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alr</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Vector3DCollection of vectors from surface to surface vertex coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        surface : surface object</span>
<span class="sd">            Surface that matches the calling surface vectors.</span>
<span class="sd">            Should be the same basetype and rez for surface subclasses.</span>

<span class="sd">        scale: number, optional, default: 1.</span>

<span class="sd">        color : str or float list of length 3 or 4.</span>
<span class="sd">            RGB or RGBA color, either a Matplotlib format string or a </span>
<span class="sd">            list of color values in range [0,1].</span>
<span class="sd">        </span>
<span class="sd">        width : number, optional, default: 1</span>
<span class="sd">            Line width of the vector.</span>

<span class="sd">        alr : scalar, optional, default: 0.25</span>
<span class="sd">            Axis length ratio, head size to vector magnitude.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Mismatched surfaces based on the number of vertices.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Vector3DCollection object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">surLen</span><span class="p">,</span> <span class="n">selfLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">)</span> <span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">surLen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">selfLen</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Surfaces have unequal number of vertices, </span><span class="si">{}</span><span class="s1"> != </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">surLen</span><span class="p">,</span> <span class="n">selfLen</span><span class="p">))</span>            
        <span class="k">if</span> <span class="n">alr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">alr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DFT_ALR</span>
        <span class="n">delta</span> <span class="o">=</span>  <span class="n">surface</span><span class="o">.</span><span class="n">vertexCoor</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">scale</span><span class="o">*</span><span class="n">delta</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vectorfield_Line3DCollection</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">alr</span><span class="p">)</span></div>

<div class="viewcode-block" id="Surface3DCollection.map_color_from_image"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.map_color_from_image">[docs]</a>    <span class="k">def</span> <span class="nf">map_color_from_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">viewport</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign image color values to surface face colors.</span>

<span class="sd">        This method is not available for composite surfaces.</span>
<span class="sd">        The entire image domain is applied to the coloring operation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname : str or file-like</span>
<span class="sd">            The image file to read: a filename, a URL or a file-like object opened</span>
<span class="sd">            in read-binary mode.  Currently restricted to PNG format.</span>
<span class="sd">        </span>
<span class="sd">        viewport : 4D array-like, optional, default: None</span>
<span class="sd">            Viewport defines the subdomain of the surface onto which</span>
<span class="sd">            the image is mapped.  The subdomain is set by normalized</span>
<span class="sd">            native surface coordinates in a 4D array.</span>
<span class="sd">            The entire surface is colored for the default of None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : surface object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isCompositeSurface</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Image operation not available for combined shapes.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surfaceShapeChanged</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Image operation may be anomalous after shape modification.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">viewport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="n">viewport</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">viewport</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span> <span class="p">(</span><span class="n">viewport</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">viewport</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;viewport list values, </span><span class="si">{}</span><span class="s1">, must be between 0 and 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">viewport</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">viewport</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;viewport list must be length 4, found </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">viewport</span><span class="p">)))</span>      
        <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="p">]</span>
        
        <span class="n">faceCenterCoor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_centers</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">inViewport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viewportCoor</span><span class="p">(</span><span class="n">faceCenterCoor</span><span class="p">,</span><span class="n">viewport</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">M_index</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">height</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">N_index</span> <span class="o">=</span> <span class="p">(</span> <span class="n">a</span><span class="o">*</span><span class="n">width</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1">#&#39;&#39;&#39;</span>
        <span class="n">orig_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facecolors</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">orig_colors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span>
            <span class="n">onearr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">faceCenterCoor</span><span class="p">)</span> <span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="n">orig_colors</span> <span class="o">=</span> <span class="n">orig_colors</span><span class="o">*</span><span class="n">onearr</span>       

        <span class="n">colorMap</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">viewport</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">colorMap</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">M_index</span><span class="p">,</span><span class="n">N_index</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="c1"># FutDev: use numpy methods to optimize efficiency.</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">orig_colors</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">colorMap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orig_colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">inViewport</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="n">colorMap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">M_index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">N_index</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>    

        <span class="bp">self</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">colorMap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isSurfaceColored</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Surface3DCollection.map_color_from_op"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.map_color_from_op">[docs]</a>    <span class="k">def</span> <span class="nf">map_color_from_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">rgb</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assignment of face color from a function.</span>

<span class="sd">        Face colors are assigned from a function</span>
<span class="sd">        of face coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        operation : function object</span>
<span class="sd">            Function that takes one argument,</span>
<span class="sd">            a 3xN Numpy array of native coordinates.</span>
<span class="sd">            The function returns a 3xN color value.</span>

<span class="sd">        rgb : bool {True, False}, optional, default: True</span>
<span class="sd">            By default, RGB color values are returned by the</span>
<span class="sd">            operation function.  If set False, the operation</span>
<span class="sd">            returns HSV color values.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : surface object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="p">]</span>
        <span class="n">faceCenterCoor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_centers</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">faceCenterCoor</span><span class="p">)</span>
        <span class="n">abc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coor_convert</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">operation</span><span class="p">(</span><span class="n">abc</span><span class="p">))</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rgb</span> <span class="p">:</span> <span class="n">RGB</span> <span class="o">=</span> <span class="n">colors</span>
        <span class="k">else</span> <span class="p">:</span>   <span class="n">RGB</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">RGB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isSurfaceColored</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Surface3DCollection.map_cmap_from_datagrid"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.map_cmap_from_datagrid">[docs]</a>    <span class="k">def</span> <span class="nf">map_cmap_from_datagrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datagrid</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">viewport</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Face color assignment using a 2D datagrid surface.</span>
<span class="sd">        </span>
<span class="sd">        Datagrid values are normalized in the range 0 to 1.</span>

<span class="sd">        This method is not available for composite surfaces.</span>
<span class="sd">        The entire datagrid domain is applied to the geometric operation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        datagrid : 2D float array</span>

<span class="sd">        cmap : str or Colormap, optional</span>
<span class="sd">            A Colormap instance or registered colormap name.</span>
<span class="sd">            If not assigned, the surface Colormap is used.</span>
<span class="sd">            The colormap maps the datagrid values to colors.</span>

<span class="sd">        viewport : 4D array-like, optional, default: None</span>
<span class="sd">            Viewport defines the subdomain of the surface onto which</span>
<span class="sd">            the datagrid is mapped.  The subdomain is set by normalized</span>
<span class="sd">            native surface coordinates in a 4D array.</span>
<span class="sd">            The entire surface is colored for the default of None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : surface object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isCompositeSurface</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Datagrid operation not available for combined shapes.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surfaceShapeChanged</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Datagrid operation may be anomalous after shape modification.&#39;</span><span class="p">)</span>

        <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="p">]</span>
        <span class="n">faceCenterCoor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_centers</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">inViewport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viewportCoor</span><span class="p">(</span><span class="n">faceCenterCoor</span><span class="p">,</span><span class="n">viewport</span><span class="p">)</span>      
        <span class="n">data</span> <span class="o">=</span> <span class="n">datagrid</span>
        <span class="n">dmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">datagrid</span><span class="p">)</span>
        <span class="n">dmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">datagrid</span><span class="p">)</span>
        <span class="n">xd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">yd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span>  <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">yd</span><span class="p">,</span> <span class="n">xd</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># FutDev: use numpy methods to optimize efficiency.</span>
        <span class="k">for</span> <span class="n">ab</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">])</span> <span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">g</span><span class="p">(</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>   
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">inViewport</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">),</span><span class="n">dmin</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">))</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">()</span>
        
        <span class="n">orig_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facecolors</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">orig_colors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span>
            <span class="n">onearr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">faceCenterCoor</span><span class="p">)</span> <span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="n">orig_colors</span> <span class="o">=</span> <span class="n">orig_colors</span><span class="o">*</span><span class="n">onearr</span>       
        
        <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">viewport</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="n">colorMap</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">colorMap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">inViewport</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">temp</span><span class="p">,</span> <span class="n">orig_colors</span> <span class="p">)</span>

        <span class="c1"># FutDev: set_color used instead of set_facecolor to eliminate &#39;gaps&#39; between faces,</span>
        <span class="c1"># however, set_edgecolor required after illumination if edges are to be displayed.</span>
        <span class="c1"># HOWEVER !!!!  if colorMap has a alpha&lt;1, these don&#39;t register with the edges.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">colorMap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isSurfaceColored</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="s1">&#39;vlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span> <span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Surface3DCollection.map_cmap_from_normals"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.map_cmap_from_normals">[docs]</a>    <span class="k">def</span> <span class="nf">map_cmap_from_normals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Face color assignment using normals relative to illumination.</span>

<span class="sd">        The dot product of face normals with the illumination direction </span>
<span class="sd">        is used to assign face colors from a colormap.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cmap : str or Colormap, optional</span>
<span class="sd">            A Colormap instance or registered colormap name.</span>
<span class="sd">            If not assigned, the surface Colormap is used.</span>
<span class="sd">            The colormap maps the dot product values to colors.</span>
<span class="sd">        </span>
<span class="sd">        direction : list of size 3, optional, default: [1,0,1]</span>
<span class="sd">            A 3D vector in xyz Cartesian coordinates designating</span>
<span class="sd">            the direction of the illumination source.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : surface object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#.....................................    </span>
        <span class="k">def</span> <span class="nf">getColorMap</span><span class="p">(</span><span class="n">fvo</span><span class="p">,</span><span class="n">cmap</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">unitVector</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">v</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span> <span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">incidentLight</span> <span class="o">=</span> <span class="n">unitVector</span><span class="p">(</span> <span class="n">direction</span> <span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">fvo</span><span class="p">,</span><span class="n">incidentLight</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">colorMap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">colorMap</span>
        <span class="c1">#.....................................</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ILLUM</span>
        <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">))</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">cm_colorMap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">()</span>

        <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="p">]</span>
        <span class="n">fvobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_normals</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>

        <span class="n">cMap</span> <span class="o">=</span> <span class="n">getColorMap</span><span class="p">(</span><span class="n">fvobj</span><span class="p">,</span> <span class="n">cm_colorMap</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">cm_colorMap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">cMap</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Surface3DCollection.map_cmap_from_op"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.map_cmap_from_op">[docs]</a>    <span class="k">def</span> <span class="nf">map_cmap_from_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Functional assignment of a color from a color map.</span>

<span class="sd">        Face coordinates are used to calculate a scalar </span>
<span class="sd">        which is then used to assign face colors from a</span>
<span class="sd">        colormap.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        operation : function object</span>
<span class="sd">            Function that takes one argument,</span>
<span class="sd">            a 3xN Numpy array of native coordinates.</span>
<span class="sd">            The function returns a Numpy array of scalar values.</span>

<span class="sd">        cmap : str or Colormap, optional</span>
<span class="sd">            A Colormap instance or registered colormap name.</span>
<span class="sd">            If not assigned, the surface Colormap is used.</span>
<span class="sd">            The colormap maps the function return values to colors.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : surface object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">))</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">()</span>

        <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="p">]</span>
        <span class="n">faceCenterCoor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_centers</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">faceCenterCoor</span><span class="p">)</span>
        <span class="c1"># .....</span>
        <span class="n">abc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coor_convert</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">operation</span><span class="p">(</span><span class="n">abc</span><span class="p">))</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">v</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">vmax</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        
        <span class="n">colorMap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="c1"># FutDev: set_color used instead of set_facecolor to eliminate &#39;gaps&#39; between faces,</span>
        <span class="c1"># however, set_edgecolor required after illumination if edges are to be displayed.</span>
        <span class="c1"># HOWEVER !!!!  if colorMap has a alpha&lt;1, these don&#39;t register with the edges.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">colorMap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isSurfaceColored</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="p">[</span><span class="s1">&#39;vlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Surface3DCollection.map_geom_from_datagrid"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.map_geom_from_datagrid">[docs]</a>    <span class="k">def</span> <span class="nf">map_geom_from_datagrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">datagrid</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">viewport</span><span class="o">=</span><span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append surface vertices proportional to 2D datagrid surface.</span>
<span class="sd">        </span>
<span class="sd">        Datagrid values are normalized in the range 0 to 1.</span>

<span class="sd">        This method is not available for composite surfaces.</span>
<span class="sd">        The entire datagrid domain is applied to the geometric operation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        datagrid : 2D array</span>

<span class="sd">        scale : number, optional, default: 1</span>

<span class="sd">        viewport : 4D array-like, optional, default: None</span>
<span class="sd">            Viewport defines the subdomain of the surface onto which</span>
<span class="sd">            the datagrid is mapped.  The subdomain is set by normalized</span>
<span class="sd">            native surface coordinates in a 4D array.</span>
<span class="sd">            The entire surface is geometrically mapped for the default of None.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : surface object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isCompositeSurface</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Datagrid operation not available for combined shapes.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surfaceShapeChanged</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Datagrid operation may be anomalous after shape modification.&#39;</span><span class="p">)</span>

        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">inViewport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viewportCoor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">,</span><span class="n">viewport</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">datagrid</span>
        <span class="n">dmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">datagrid</span><span class="p">)</span>
        <span class="n">dmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">datagrid</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">dmax</span><span class="o">-</span><span class="n">dmin</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">datagrid</span> <span class="o">-</span> <span class="n">dmin</span><span class="p">)</span><span class="o">/</span><span class="n">delta</span>
        <span class="n">xd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">yd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span>  <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">yd</span><span class="p">,</span> <span class="n">xd</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>

        <span class="c1"># FutDev: optimize efficiency (?).</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ab</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">])</span> <span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">g</span><span class="p">(</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">inViewport</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)))</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        
        <span class="c1"># FutDev: &#39;fVal&#39; only applicable for initial subclassed</span>
        <span class="c1"># surfaces to get surface normals at a vertex.</span>
        <span class="c1"># Future work: to make this generic for any surface.</span>
        <span class="n">fVal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_Vector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="n">fVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">disp_Vector</span>

        <span class="n">v</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span> <span class="o">+</span> <span class="n">scale</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">fVal</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span> <span class="o">=</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_geometric_bounds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_verts</span><span class="p">(</span> <span class="n">verts</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_surfaceShapeChanged</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Surface3DCollection.map_geom_from_image"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.map_geom_from_image">[docs]</a>    <span class="k">def</span> <span class="nf">map_geom_from_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">viewport</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cref</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">hzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append surface vertices proportional to image color component values.</span>

<span class="sd">        For planar and polar coordinates, the z-coordinate is appended.</span>
<span class="sd">        For cylindrical and spherical coordinates, the r-coordinate is appended.</span>

<span class="sd">        This method is not available for composite surfaces.</span>
<span class="sd">        The entire image domain is applied to the geometric operation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname : str or file-like</span>
<span class="sd">            The image file to read: a filename, a URL or a file-like object opened</span>
<span class="sd">            in read-binary mode.  Currently restricted to PNG format.</span>

<span class="sd">        scale : number</span>

<span class="sd">        cref : {&#39;r&#39;,&#39;g&#39;,&#39;b&#39;,&#39;h&#39;,&#39;s&#39;,&#39;v&#39;}, optional, default: &#39;v&#39;</span>
<span class="sd">            Sets which color tuple value to use for geometry mapping.</span>
<span class="sd">            Note: only the first character of the string is evaluated.</span>

<span class="sd">        hzero : number or None, optional, default: 0</span>
<span class="sd">            Argument is used if cref is set to &#39;h&#39;.</span>
<span class="sd">            The hzero magnitude indicates the Hue value for a zero coordinate</span>
<span class="sd">            diplacement. The hzero sign (positive or negative),</span>
<span class="sd">            indicates the direction of increasing value in the</span>
<span class="sd">            appended coordinate with hue value.  Range of hzero is [-1,1].</span>

<span class="sd">        viewport : 4D array-like, optional, default: None</span>
<span class="sd">            Viewport defines the subdomain of the surface onto which</span>
<span class="sd">            the image is mapped.  The subdomain is set by normalized</span>
<span class="sd">            native surface coordinates in a 4D array.</span>
<span class="sd">            The entire surface is geometrically mapped for the default of None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : surface object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ..............................................................</span>
        <span class="k">def</span> <span class="nf">getIndex</span><span class="p">(</span><span class="n">cref</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">cref</span> <span class="o">=</span> <span class="n">cref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">valIndex</span> <span class="o">=</span> <span class="s1">&#39;rgbhsv&#39;</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">cref</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">valIndex</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid cref argument: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cref</span><span class="p">))</span>
            <span class="n">isHSV</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">valIndex</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="p">:</span>
                <span class="n">valIndex</span> <span class="o">-=</span> <span class="mi">3</span>
                <span class="n">isHSV</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">valIndex</span><span class="p">,</span> <span class="n">isHSV</span>
        <span class="c1"># ..............................................................</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isCompositeSurface</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Image operation not available for combined shapes.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_surfaceShapeChanged</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Image operation may be anomalous after shape modification.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">hzero</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">hzero</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;hzero must be between -1 and 1, found </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hzero</span><span class="p">))</span>
        <span class="n">ho</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span><span class="n">hzero</span><span class="p">)</span>
        <span class="n">hsgn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">hzero</span><span class="p">)</span>
        <span class="n">h_ref</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">h</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span> <span class="n">ho</span> <span class="o">+</span> <span class="n">hsgn</span><span class="o">*</span><span class="n">h</span> <span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="c1"># ...................</span>
        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">inViewport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viewportCoor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">,</span><span class="n">viewport</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">x_index</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">height</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">y_index</span> <span class="o">=</span> <span class="p">(</span> <span class="n">a</span><span class="o">*</span><span class="n">width</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">valIndex</span><span class="p">,</span> <span class="n">isHSV</span> <span class="o">=</span> <span class="n">getIndex</span><span class="p">(</span><span class="n">cref</span><span class="p">)</span>
        <span class="n">rgbcolor</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">x_index</span><span class="p">,</span><span class="n">y_index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">isHSV</span> <span class="p">:</span>
            <span class="n">hsvcolor</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">rgb_to_hsv</span><span class="p">(</span><span class="n">rgbcolor</span><span class="p">)</span>
            <span class="n">hsvcolor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">hsvcolor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">valIndex</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span> <span class="n">d</span><span class="o">=</span> <span class="n">h_ref</span><span class="p">(</span><span class="n">hsvcolor</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span> <span class="p">:</span>           <span class="n">d</span> <span class="o">=</span> <span class="n">hsvcolor</span><span class="p">[</span><span class="n">valIndex</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">rgbcolor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">rgbcolor</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">rgbcolor</span><span class="p">[</span><span class="n">valIndex</span><span class="p">]</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">inViewport</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)))</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        
        <span class="c1"># FutDev: &#39;fVal&#39; only applicable for initial subclassed surfaces</span>
        <span class="c1"># surfaces to get surface normals at a vertex.</span>
        <span class="c1"># Future work: to make this generic for any surface.</span>
        <span class="n">fVal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_Vector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="n">fVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">disp_Vector</span>

        <span class="n">v</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span> <span class="o">+</span> <span class="n">scale</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">fVal</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span> <span class="o">=</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_geometric_bounds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_verts</span><span class="p">(</span> <span class="n">verts</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_surfaceShapeChanged</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span></div>
    
<div class="viewcode-block" id="Surface3DCollection.map_geom_from_op"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.map_geom_from_op">[docs]</a>    <span class="k">def</span> <span class="nf">map_geom_from_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">returnxyz</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Functional transformation of surface vertex coordinates.</span>

<span class="sd">        This method is not available for composite surfaces.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        operation : function object</span>
<span class="sd">            Coordinate mapping function that takes one</span>
<span class="sd">            argument, a 3xN Numpy array of native coordinates.</span>
<span class="sd">            The function returns a 3xN array of coordinates.</span>

<span class="sd">        returnxyz : bool { True, False }, optional, default: False</span>
<span class="sd">            By default, native coordinates are returned by the</span>
<span class="sd">            operation function.  If set True, the operation</span>
<span class="sd">            returns xyz Cartesian coordinates.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : surface object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isCompositeSurface</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Map operation not available for combined shapes.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tranformVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">returnxyz</span><span class="p">)</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span> <span class="o">=</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_geometric_bounds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_verts</span><span class="p">(</span> <span class="n">verts</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_surfaceShapeChanged</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span></div>
    
<div class="viewcode-block" id="Surface3DCollection.clip"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.clip">[docs]</a>    <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">usexyz</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove faces from the surface.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        operation : function object</span>
<span class="sd">            Function that takes one argument, a 3xN Numpy array of coordinates.</span>
<span class="sd">            The function returns a bool { True, False } indicating if</span>
<span class="sd">            the face, at the face centered coordinate, is to be </span>
<span class="sd">            retained (True), otherwise, the face is removed from the</span>
<span class="sd">            surface (False).</span>

<span class="sd">        usexyz : bool { True, False }, default: False</span>
<span class="sd">            If True, face centers are passed to the operation function</span>
<span class="sd">            in xyz coordinates.  If False, face centers are passed</span>
<span class="sd">            in native coordinates.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : surface object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Clip operation MUST use xyz coordinates for combined shapes.</span>
        <span class="c1"># since native coordinate may be undefined.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isCompositeSurface</span> <span class="p">:</span> <span class="n">usexyz</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="p">]</span>
        <span class="n">faceCenterCoor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_centers</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>

        <span class="n">onearr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span><span class="p">)</span> <span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">orig_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facecolors</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">orig_colors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">orig_colors</span> <span class="o">=</span> <span class="n">orig_colors</span><span class="o">*</span><span class="n">onearr</span>

        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">faceCenterCoor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">usexyz</span> <span class="ow">is</span> <span class="kc">False</span> <span class="p">:</span>  <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coor_convert</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="n">abc</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="n">rst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">operation</span><span class="p">(</span><span class="n">abc</span><span class="p">))</span>

        <span class="c1"># FutDev: better way to do this loop?</span>
        <span class="n">fvi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fcol</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">faceCenterCoor</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">rst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span>
                <span class="n">fvi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">fcol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orig_colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="c1"># this permits multiple clips without changing original, so restore is available.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoredClip</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restoredClip</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;faces&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span> <span class="p">:</span> <span class="n">orig_colors</span> <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="o">=</span> <span class="n">fvi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">fcol</span><span class="p">)</span>        
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_verts</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">fvi</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Surface3DCollection.restore_from_clip"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.restore_from_clip">[docs]</a>    <span class="k">def</span> <span class="nf">restore_from_clip</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Reset face and colors prior to any clip operation.&quot;&quot;&quot;</span>
        
        <span class="c1"># FutDev: this method needs thorough testing.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoredClip</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;There is no clipped surface to restore.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="n">fvi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoredClip</span><span class="p">[</span><span class="s1">&#39;faces&#39;</span><span class="p">]</span>
        <span class="n">fcol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoredClip</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restoredClip</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="o">=</span> <span class="n">fvi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">fcol</span><span class="p">)</span>        
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_verts</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">fvi</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Surface3DCollection.set_surface_alpha"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.set_surface_alpha">[docs]</a>    <span class="k">def</span> <span class="nf">set_surface_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjust the alpha value of the surface face colors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        alpha : scalar</span>
<span class="sd">              Alpha is in the range 0 to 1.</span>

<span class="sd">        constant : bool { True, False }, optional, False</span>
<span class="sd">            If False, face color values are multiplied by</span>
<span class="sd">            alpha.  If True, all face colors alpha channels</span>
<span class="sd">            are assigned to alpha.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : surface object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">alpha</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">alpha</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;surface alpha must be between 0 and 1, found </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>

        <span class="n">orig_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facecolors</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">orig_colors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span>
            <span class="n">onearr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span><span class="p">)</span> <span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="n">orig_colors</span> <span class="o">=</span> <span class="n">orig_colors</span><span class="o">*</span><span class="n">onearr</span>       
        <span class="k">if</span> <span class="n">constant</span> <span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">put_along_axis</span><span class="p">(</span><span class="n">orig_colors</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">]]),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">colorMap</span> <span class="o">=</span> <span class="n">orig_colors</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colorMap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">orig_colors</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="n">alpha</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">colorMap</span><span class="p">)</span>       
        <span class="k">return</span> <span class="bp">self</span>   </div>
   
<div class="viewcode-block" id="Surface3DCollection.shade"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.shade">[docs]</a>    <span class="k">def</span> <span class="nf">shade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduce surface HSV color Value based on face normals.</span>
<span class="sd">        </span>
<span class="sd">        The dot product of face normals with the illumination direction </span>
<span class="sd">        is used to adjust face HSV color value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        depth : scalar, optional, default: 0</span>
<span class="sd">            Minimum color value of shaded surface faces.</span>
<span class="sd">            Depth value ranges from 0 to 1.</span>

<span class="sd">        direction : array-like, optional, default: (1,0,1)</span>
<span class="sd">            A xyz vector pointing to the illumination source. </span>

<span class="sd">        contrast : scalar, optional, default: 1</span>
<span class="sd">            Shading contrast adjustment from low to high with a value</span>
<span class="sd">            of 1 for linear variations with the normal direction.</span>
<span class="sd">            Contrast value ranges from 0.1 to 3.     </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : surface object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ILLUM</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span> <span class="p">(</span><span class="n">depth</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">depth</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;depth values, </span><span class="si">{}</span><span class="s1">, must be between 0 and 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">depth</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">contrast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">contrast</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">or</span> <span class="n">contrast</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;contrast must be between 0.1 and 3. , found </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">contrast</span><span class="p">))</span>
    
        <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="p">]</span>
        <span class="n">norms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_normals</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="n">unitDirection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span> <span class="n">direction</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">dprod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">norms</span><span class="p">,</span> <span class="n">unitDirection</span> <span class="p">)</span>

        <span class="c1"># 0&lt;d&lt;1, heuristic function for </span>
        <span class="c1"># normalized domain of effective dot product, d=f(dprod)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">dprod</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">contrast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span>  <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dprod</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dprod</span><span class="p">)</span> <span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">contrast</span><span class="p">)</span> <span class="p">)</span>      
        
        <span class="c1"># extract HSV, leaving alpha unchanged.</span>
        <span class="n">orig_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facecolors</span>
        <span class="n">onearr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">norms</span><span class="p">)</span> <span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">orig_colors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">orig_colors</span> <span class="o">=</span> <span class="n">orig_colors</span><span class="o">*</span><span class="n">onearr</span>
        <span class="n">alphas</span> <span class="o">=</span> <span class="n">orig_colors</span><span class="p">[:,</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">fc_less_alpha</span> <span class="o">=</span> <span class="n">orig_colors</span><span class="p">[:,:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">hsv_vals</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgb_to_hsv</span><span class="p">(</span><span class="n">fc_less_alpha</span><span class="p">)</span>

        <span class="c1"># adjust color value with multiplier.</span>
        <span class="n">cvm</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">depth</span><span class="p">)</span><span class="o">*</span><span class="n">d</span> <span class="o">+</span> <span class="n">depth</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)))[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">hsv_vals</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cvm</span><span class="o">*</span><span class="n">hsv_vals</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">])[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rgb_vals</span> <span class="o">=</span>  <span class="n">cm</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">hsv_vals</span><span class="p">)</span>
        <span class="n">shade_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">rgb_vals</span><span class="p">,</span> <span class="n">alphas</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">shade_colors</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Surface3DCollection.hilite"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.hilite">[docs]</a>    <span class="k">def</span> <span class="nf">hilite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">focus</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Increase surface HSV color Value and reduce Saturation, based on face normals.</span>

<span class="sd">        The dot product of face normals with the illumination direction </span>
<span class="sd">        is used to adjust face HSV color value and saturation.</span>
<span class="sd">        Faces having normals with a negative component in the direction of</span>
<span class="sd">        illumination are not affected. The reduction of color saturation is</span>
<span class="sd">        proportional to the increase in color value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        height : scalar, optional, default: 1</span>
<span class="sd">            Maximum color value of highlighted surface faces.</span>
<span class="sd">            Height value ranges from 0 to 1.</span>

<span class="sd">        direction : array-like, optional, default: (1,0,1)</span>
<span class="sd">            A xyz vector pointing to the illumination source. </span>

<span class="sd">        focus : scalar, optional, default: 1</span>
<span class="sd">            Highlighting focus adjustment from low to high with a value</span>
<span class="sd">            of 1 for quadratic variations with the normal direction.</span>
<span class="sd">            Focus value ranges from 0.1 to 3.     </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : surface object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ILLUM</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span> <span class="p">(</span><span class="n">height</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">height</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;height values, </span><span class="si">{}</span><span class="s1">, must be between 0 and 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">height</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">focus</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">focus</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="ow">or</span> <span class="n">focus</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;focus must be between 0.1 and 3. , found </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">focus</span><span class="p">))</span>
    
        <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span> <span class="p">]</span>
        <span class="n">norms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_face_normals</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="n">unitDirection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span> <span class="n">direction</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">dprod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">norms</span><span class="p">,</span> <span class="n">unitDirection</span> <span class="p">)</span>

        <span class="c1"># 0&lt;d&lt;1, heuristic function for </span>
        <span class="c1"># normalized domain of effective dot product, d=f(dprod)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dprod</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dprod</span><span class="p">)</span>       
        <span class="k">if</span> <span class="n">focus</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">focus</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">d0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">focus</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">d0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">d0</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mf">1.0</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">focus</span><span class="p">)</span>

        <span class="c1"># extract HSV, leaving alpha unchanged.</span>
        <span class="n">orig_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facecolors</span>
        <span class="n">onearr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">norms</span><span class="p">)</span> <span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">orig_colors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">orig_colors</span> <span class="o">=</span> <span class="n">orig_colors</span><span class="o">*</span><span class="n">onearr</span>
        <span class="n">alphas</span> <span class="o">=</span> <span class="n">orig_colors</span><span class="p">[:,</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">fc_less_alpha</span> <span class="o">=</span> <span class="n">orig_colors</span><span class="p">[:,:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">hsv_vals</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgb_to_hsv</span><span class="p">(</span><span class="n">fc_less_alpha</span><span class="p">)</span>

        <span class="c1"># adjust color saturation and value, linear with normalized domain.</span>
        <span class="n">hd</span> <span class="o">=</span> <span class="n">height</span><span class="o">*</span><span class="n">d</span>
        <span class="n">omhd</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">norms</span><span class="p">)</span> <span class="p">)</span> <span class="o">-</span> <span class="n">hd</span><span class="p">)</span>
        <span class="n">omhd</span> <span class="o">=</span> <span class="n">omhd</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">hsv_vals</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">omhd</span><span class="o">*</span><span class="n">hsv_vals</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hsv_vals</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">omhd</span><span class="o">*</span><span class="n">hsv_vals</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">])[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hsv_vals</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">hd</span>
        <span class="n">rgb_vals</span> <span class="o">=</span>  <span class="n">cm</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">hsv_vals</span><span class="p">)</span>
        <span class="n">hilite_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">rgb_vals</span><span class="p">,</span> <span class="n">alphas</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">hilite_colors</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Surface3DCollection.transform"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.transform">[docs]</a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>  <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Linear transformation of the surface object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rotate :  array-like, optional, default: None</span>
<span class="sd">            A 3 by 3 rotation matrix.</span>

<span class="sd">        scale : 3D array or scalar, optional, default: 1.0</span>
<span class="sd">            Multipliers of the object coordinates, in</span>
<span class="sd">            xyz coordinates. If a single scalar, three</span>
<span class="sd">            multipliers are the same value.</span>
<span class="sd">        </span>
<span class="sd">        translate : array-like, optional, default: [0,0,0]</span>
<span class="sd">            A xyz translation vector of object origin. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : surface object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rotate</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">rotate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">scale</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="c1">#.....................................    </span>
        <span class="k">def</span> <span class="nf">isOrth</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
            <span class="n">tol</span> <span class="o">=</span> <span class="mf">0.00001</span>
            <span class="n">prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">M</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">prod</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span><span class="o">&gt;</span><span class="n">tol</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
        <span class="c1">#.....................................    </span>
        <span class="n">trans</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">V</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">T</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>  <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">S</span><span class="p">),</span><span class="n">rotate</span><span class="p">)</span> <span class="p">,</span><span class="n">T</span><span class="p">)</span>
        <span class="c1">#.....................................    </span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isOrth</span><span class="p">(</span><span class="n">rotate</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Transform rotate matrix is NOT Orthoginal.&#39;</span><span class="p">)</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">trans</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">translate</span>  <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="n">nScal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>   <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vector_field</span> <span class="o">=</span> <span class="n">trans</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_field</span><span class="p">,</span> <span class="n">nScal</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>  <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertexCoor</span> <span class="o">=</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_geometric_bounds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_verts</span><span class="p">(</span> <span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fvIndices</span><span class="p">]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_surfaceShapeChanged</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translation</span> <span class="o">=</span> <span class="n">translate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotate</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Surface3DCollection.get_transformAxis"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.get_transformAxis">[docs]</a>    <span class="k">def</span> <span class="nf">get_transformAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lenmult</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Line3DCollection of the &#39;last&#39; transformed surface coordinate axis.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lenmult : scalar or 3D array, optional, default: 1</span>
<span class="sd">            Scalar multiplier of the three coordinate axis.</span>

<span class="sd">        width : scalar, optional, default: 1.5</span>
<span class="sd">            Line width of the coordinate axis.   </span>

<span class="sd">        colors : a Color or 3D array of Colors, optional, default: [&#39;r&#39;,&#39;g&#39;,&#39;b&#39;]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Line3DCollection</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">lenmult</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">dDelta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">scale</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">npdot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dDelta</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span>
        <span class="n">npdot2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">npdot</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">npdot2</span><span class="p">,</span><span class="mi">0</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">translation</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="n">colorMap</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">colorMap</span> <span class="o">=</span> <span class="n">colors</span>
        <span class="n">axisCol</span> <span class="o">=</span> <span class="n">Line3DCollection</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colorMap</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">axisCol</span>      </div>

<div class="viewcode-block" id="Surface3DCollection.svd"><a class="viewcode-back" href="../../docs/clss_mod/surface.base.html#s3dlib.surface.Surface3DCollection.svd">[docs]</a>    <span class="k">def</span> <span class="nf">svd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transform surface geometry based on a data set.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : N x 3 array of x,y,z data coordinates.</span>
<span class="sd">        </span>
<span class="sd">        pc : scalar, optional, default: None</span>
<span class="sd">            Sets the minimum size of the surface based on the</span>
<span class="sd">            relative number of data.  Value range from 0 to 1, </span>
<span class="sd">            with 1 for 100%.  If None, one standard deviation</span>
<span class="sd">            of the data sets the surface size.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        disArr : array of N floats, normalized to the surface size.</span>
<span class="sd">        </span>
<span class="sd">        t : a 4D array containing surface and data properties</span>
<span class="sd">            [standard deviation, rotation matrix, scaling, translation]</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># FutDev: This is a &#39;proof-of-concept&#39; for data visulaizations</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isCompositeSurface</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Data operation not available for combined shapes.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="n">data_mean</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">data_centered</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">data_mean</span>

        <span class="n">Ua</span><span class="p">,</span> <span class="n">sa</span><span class="p">,</span> <span class="n">Vta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">data_centered</span><span class="p">)</span>
        <span class="n">dataAve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sa</span><span class="p">)</span>       
        <span class="n">scale</span> <span class="o">=</span> <span class="n">sa</span><span class="o">/</span><span class="n">dataAve</span>
        <span class="n">tranData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">data_centered</span><span class="p">,</span><span class="n">Vta</span><span class="o">.</span><span class="n">T</span><span class="p">),</span><span class="n">scale</span> <span class="p">)</span>       
        <span class="n">disArr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">tranData</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>      
        <span class="n">disArrSum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">disArr</span><span class="p">)</span>
        <span class="n">lendisArr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">disArr</span><span class="p">)</span>
        <span class="n">refLen</span> <span class="o">=</span> <span class="n">disArrSum</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lendisArr</span><span class="p">)</span>        
        <span class="n">s</span><span class="o">=</span><span class="n">refLen</span>
        <span class="n">disArr</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">disArr</span><span class="p">,</span><span class="n">refLen</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">pc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">disArr</span><span class="p">)</span>
            <span class="n">dindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dlen</span><span class="o">*</span><span class="n">pc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dindex</span> <span class="o">&gt;=</span> <span class="n">dlen</span> <span class="p">:</span> <span class="n">dindex</span> <span class="o">=</span> <span class="n">dlen</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">dindex</span> <span class="o">&lt;</span>  <span class="mi">0</span>    <span class="p">:</span> <span class="n">dindex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">disArr</span><span class="p">)[</span><span class="n">dindex</span><span class="p">]</span>
            <span class="n">disArr</span> <span class="o">=</span> <span class="n">disArr</span><span class="o">/</span><span class="n">s</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">refLen</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">Vta</span><span class="p">,</span><span class="n">s</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span><span class="n">data_mean</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">disArr</span><span class="p">,</span> <span class="p">[</span><span class="n">refLen</span><span class="p">,</span><span class="n">Vta</span><span class="p">,</span><span class="n">s</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span><span class="n">data_mean</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="PlanarSurface"><a class="viewcode-back" href="../../docs/clss_mod/surface.planar.html#s3dlib.surface.PlanarSurface">[docs]</a><span class="k">class</span> <span class="nc">PlanarSurface</span><span class="p">(</span><span class="n">Surface3DCollection</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flat square 3D surface in Cartesian coordinates.</span>

<span class="sd">    Methods are inherited from the Surface3DCollection.</span>
<span class="sd">    Planar surface geometries are created in this subclass.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_planar_surfaces_dictionary</span><span class="p">()</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Constructs the dictionary of base planar surface geometries. &quot;&quot;&quot;</span>

        <span class="n">surfacesDictionary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">baseVert</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>        
        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>        
        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>        
        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>        
        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">qVert</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="p">:</span> <span class="n">qVert</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">baseVert</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">quadFaces</span><span class="o">=</span><span class="p">(</span> 
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">octFaces1</span><span class="o">=</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">octFaces2</span><span class="o">=</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="p">)</span>

        <span class="n">Fq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">quadFaces</span><span class="p">)</span>
        <span class="n">F1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">octFaces1</span><span class="p">)</span>
        <span class="n">F2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">octFaces2</span><span class="p">)</span>
        <span class="n">quad</span> <span class="o">=</span>  <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">quadFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">qVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fq</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>
        <span class="n">oct1</span> <span class="o">=</span>  <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">octFaces1</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">F1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>
        <span class="n">oct2</span> <span class="o">=</span>  <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">octFaces2</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">F2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>

        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;quad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">quad</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;oct1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oct1</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;oct2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oct2</span>

        <span class="c1"># ----------------------------------------------------------</span>
        <span class="n">mr</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">MR</span> <span class="o">=</span> <span class="n">mr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">qVertS</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;quad&#39;</span><span class="p">][</span><span class="s1">&#39;baseVerticesCoor&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">qVertS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>   <span class="p">[</span> <span class="n">MR</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">qVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>  <span class="mi">0</span><span class="p">,</span> <span class="n">MR</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">qVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">MR</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">qVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span>  <span class="p">,</span><span class="o">-</span><span class="n">MR</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">baseVertS</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;oct1&#39;</span><span class="p">][</span><span class="s1">&#39;baseVerticesCoor&#39;</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>   <span class="p">[</span> <span class="n">mr</span><span class="p">,</span> <span class="n">mr</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">mr</span><span class="p">,</span> <span class="n">mr</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">mr</span><span class="p">,</span><span class="o">-</span><span class="n">mr</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">mr</span><span class="p">,</span><span class="o">-</span><span class="n">mr</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">quadFacesS</span><span class="o">=</span><span class="p">(</span> 
            <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="p">)</span>

        <span class="n">octFaces1S</span><span class="o">=</span><span class="p">(</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],[</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">],[</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">],[</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">],[</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span> <span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">],[</span> <span class="mi">8</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span> <span class="p">)</span>

        <span class="n">octFaces2S</span><span class="o">=</span><span class="p">(</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">],[</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">],[</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
            <span class="p">[</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span> <span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">],[</span> <span class="mi">8</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span> <span class="p">)</span>


        <span class="n">FqS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">quadFacesS</span><span class="p">)</span>
        <span class="n">F1S</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">octFaces1S</span><span class="p">)</span>
        <span class="n">F2S</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">octFaces2S</span><span class="p">)</span>
        <span class="n">quadS</span> <span class="o">=</span>  <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">quadFacesS</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">qVertS</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">FqS</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>
        <span class="n">oct1S</span> <span class="o">=</span>  <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">octFaces1S</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVertS</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">F1S</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>
        <span class="n">oct2S</span> <span class="o">=</span>  <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">octFaces2S</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVertS</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">F2S</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>

        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;quad_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">quadS</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;oct1_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oct1S</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;oct2_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oct2S</span>

        <span class="k">return</span> <span class="n">surfacesDictionary</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_midVectorFun</span><span class="p">(</span><span class="n">vectA</span><span class="p">,</span> <span class="n">vectB</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Mid-point between two points in the xy plane.&quot;&quot;&quot;</span>

        <span class="n">mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vectA</span><span class="p">,</span><span class="n">vectB</span><span class="p">)</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="n">mid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mid</span>
    
    <span class="n">_base_surfaces</span> <span class="o">=</span> <span class="n">_get_planar_surfaces_dictionary</span><span class="o">.</span><span class="vm">__func__</span><span class="p">()</span>
    <span class="n">_default_base</span> <span class="o">=</span> <span class="s1">&#39;quad&#39;</span>  <span class="c1"># default assignment is indicated in __init Docstring.</span>

<div class="viewcode-block" id="PlanarSurface.fev"><a class="viewcode-back" href="../../docs/clss_mod/surface.planar.html#s3dlib.surface.PlanarSurface.fev">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fev</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">rez</span><span class="p">,</span> <span class="n">basetype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the number of faces, edges, and vertices of a PlanarSurface.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rez : integer</span>
<span class="sd">            Number of recursive subdivisions of a triangulated base faces.</span>
<span class="sd">        </span>
<span class="sd">        basetype : string</span>
<span class="sd">            Starting surface geometries from which the surface would be</span>
<span class="sd">            constructed using recursive subdivisions of the triangular faces.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list: the number of faces, edges, and vertices.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fev</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">basetype</span><span class="p">,</span><span class="bp">cls</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlanarSurface.meshgrid"><a class="viewcode-back" href="../../docs/clss_mod/surface.planar.html#s3dlib.surface.PlanarSurface.meshgrid">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">revnormal</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a PlanarSurface object based on a meshgrid.&quot;&quot;&quot;</span>

        <span class="n">vertCoor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span> <span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">lenY</span><span class="p">,</span> <span class="n">lenX</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">mtr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lenX</span><span class="o">*</span><span class="n">lenY</span><span class="p">)</span>  <span class="p">,</span> <span class="p">(</span><span class="n">lenY</span><span class="p">,</span><span class="n">lenX</span><span class="p">))</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">mtr</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">lenX</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">lenY</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">lenX</span> <span class="o">+</span><span class="mi">1</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">lenX</span>
        <span class="k">if</span> <span class="n">revnormal</span> <span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">B</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">D</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">t</span>
        <span class="n">faceIndices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span> <span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">D</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">PlanarSurface</span><span class="p">(</span> <span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">vertexCoor</span> <span class="o">=</span> <span class="n">vertCoor</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">fvIndices</span> <span class="o">=</span> <span class="n">faceIndices</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_normal_scale</span> <span class="o">=</span> <span class="n">_normLength</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">faceIndices</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_set_geometric_bounds</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_surfaceShapeChanged</span> <span class="o">=</span> <span class="kc">True</span>        

        <span class="n">v</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="n">fvi</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">fvIndices</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">set_verts</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">fvi</span><span class="p">])</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">triangulate</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rez</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">basetype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create flat square surface of 2 x 2 units.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rez : integer, optional, default: 0</span>
<span class="sd">            Number of recursive subdivisions of the triangulated base faces.</span>
<span class="sd">            Rez values range from 0 to 7.</span>
<span class="sd">            </span>
<span class="sd">        basetype : {&#39;quad&#39;,&#39;oct1&#39;,&#39;oct2&#39;}, optional, default: &#39;quad&#39;</span>
<span class="sd">            Starting surface geometries from which the surface is</span>
<span class="sd">            constructed using recursive subdivisions of the triangular faces.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If rez is not an integer in range 0 to 7.</span>
<span class="sd">            If basetype is not recognized for this surface constructor.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        *args, **kwargs</span>
<span class="sd">            All other parameters are passed on to &#39;s3dlib.surface.Surface3DCollection&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrect rez type, must ba of type int&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rez</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">rez</span><span class="o">&gt;</span><span class="n">_MAXREZ</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrest rez of </span><span class="si">{}</span><span class="s1">, must be an int, 0 &lt;= rez &lt;= </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">_MAXREZ</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">basetype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">basetype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_base</span>
        <span class="k">if</span> <span class="n">basetype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_surfaces</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Basetype </span><span class="si">{}</span><span class="s1"> is not recognized. Possible values are: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">basetype</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_surfaces</span><span class="p">)))</span>
        <span class="n">baseSurfObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_surfaces</span><span class="p">[</span><span class="n">basetype</span><span class="p">]</span>
        <span class="n">baseVcoor</span> <span class="o">=</span> <span class="n">baseSurfObj</span><span class="p">[</span><span class="s1">&#39;baseVerticesCoor&#39;</span><span class="p">]</span>
        <span class="n">baseFaceVertexIndices</span> <span class="o">=</span><span class="n">baseSurfObj</span><span class="p">[</span><span class="s1">&#39;baseFaceIndices&#39;</span><span class="p">]</span>
        <span class="n">indexObj</span><span class="p">,</span><span class="n">vertexCoor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangulateBase</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">baseVcoor</span><span class="p">,</span><span class="n">baseFaceVertexIndices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_midVectorFun</span><span class="p">)</span>
        <span class="n">faceIndices</span> <span class="o">=</span> <span class="n">indexObj</span><span class="p">[</span><span class="s1">&#39;face&#39;</span><span class="p">]</span>
        <span class="n">edgeIndices</span> <span class="o">=</span> <span class="n">indexObj</span><span class="p">[</span><span class="s1">&#39;edge&#39;</span><span class="p">]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">vertexCoor</span><span class="p">,</span> <span class="n">faceIndices</span><span class="p">,</span> <span class="n">edgeIndices</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_normal_scale</span> <span class="o">=</span> <span class="n">_normLength</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">faceIndices</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rez</span> <span class="o">=</span> <span class="n">rez</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_basetype</span> <span class="o">=</span> <span class="n">basetype</span>
        <span class="k">return</span>

<div class="viewcode-block" id="PlanarSurface.scale_dataframe"><a class="viewcode-back" href="../../docs/clss_mod/surface.planar.html#s3dlib.surface.PlanarSurface.scale_dataframe">[docs]</a>    <span class="k">def</span> <span class="nf">scale_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Linear scale and translate the surface.</span>

<span class="sd">        Used for scaling a surface geometry based on a datagrid.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X, Y, Z : 2d arrays</span>
<span class="sd">            Minimum and maximum values of the arrays are used to scale</span>
<span class="sd">            and translate the surface from an intial domain of</span>
<span class="sd">            [ (-1,1), (-1,1), (0,1) ]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : PlanarSurface object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Xmin</span><span class="p">,</span> <span class="n">Xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">Ymin</span><span class="p">,</span> <span class="n">Ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">Y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">Zmin</span><span class="p">,</span> <span class="n">Zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">Z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
        <span class="n">Xscale</span> <span class="o">=</span> <span class="p">(</span><span class="n">Xmax</span><span class="o">-</span><span class="n">Xmin</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">X0</span> <span class="o">=</span> <span class="p">(</span><span class="n">Xmax</span><span class="o">+</span><span class="n">Xmin</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">Yscale</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ymax</span><span class="o">-</span><span class="n">Ymin</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">Y0</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ymax</span><span class="o">+</span><span class="n">Ymin</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">Zscale</span> <span class="o">=</span> <span class="n">Zmax</span><span class="o">-</span><span class="n">Zmin</span>
        <span class="n">Z0</span> <span class="o">=</span> <span class="n">Zmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="p">[</span><span class="n">Xscale</span><span class="p">,</span><span class="n">Yscale</span><span class="p">,</span><span class="n">Zscale</span><span class="p">],</span><span class="n">translate</span><span class="o">=</span><span class="p">[</span><span class="n">X0</span><span class="p">,</span><span class="n">Y0</span><span class="p">,</span><span class="n">Z0</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>

<div class="viewcode-block" id="PolarSurface"><a class="viewcode-back" href="../../docs/clss_mod/surface.polar.html#s3dlib.surface.PolarSurface">[docs]</a><span class="k">class</span> <span class="nc">PolarSurface</span><span class="p">(</span><span class="n">Surface3DCollection</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flat disk 3D surface in polar coordinates.</span>


<span class="sd">    Methods are inherited from the Surface3DCollection.</span>
<span class="sd">    Polar surface geometries are created in this subclass.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_polar_surfaces_dictionary</span><span class="p">()</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Constructs the dictionary of base polar surface geometries.&quot;&quot;&quot;</span>

        <span class="n">surfacesDictionary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">soff</span> <span class="o">=</span> <span class="mf">0.0001</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    
        <span class="n">baseVert</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">qVert</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">qVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">qVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">qVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">qVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">qVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">baseVertS</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x0S</span><span class="p">,</span> <span class="n">y0S</span> <span class="o">=</span> <span class="n">soff</span><span class="o">*</span><span class="n">y0</span><span class="p">,</span> <span class="n">soff</span><span class="o">*</span><span class="n">x0</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="n">y0S</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">y0S</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x0S</span><span class="p">,</span>  <span class="n">y0S</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>   <span class="mi">0</span><span class="p">,</span> <span class="n">soff</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0S</span><span class="p">,</span>  <span class="n">y0S</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0S</span><span class="p">,</span> <span class="o">-</span><span class="n">y0S</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>   <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">soff</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x0S</span><span class="p">,</span> <span class="o">-</span><span class="n">y0S</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">qVertS</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">qVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="n">soff</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">qVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">soff</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">qVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">qVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">qVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">qVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">soff</span><span class="p">,</span> <span class="n">soff</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">qVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">soff</span> <span class="p">,</span><span class="n">soff</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">qVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">soff</span><span class="p">,</span><span class="o">-</span><span class="n">soff</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">qVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">soff</span><span class="p">,</span><span class="o">-</span><span class="n">soff</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">baseFaces</span><span class="o">=</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">quadFaces</span><span class="o">=</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">baseFacesS</span><span class="o">=</span><span class="p">(</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>  <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>  <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">11</span><span class="p">]</span> <span class="p">)</span>

        <span class="n">quadFacesS</span><span class="o">=</span><span class="p">(</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="p">)</span>

        <span class="n">Fs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">quadFaces</span><span class="p">)</span>
        <span class="n">Fh</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFaces</span><span class="p">)</span>
        <span class="n">FsS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">quadFacesS</span><span class="p">)</span>
        <span class="n">FhS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFacesS</span><span class="p">)</span>
        <span class="n">square</span> <span class="o">=</span>  <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">quadFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">qVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fs</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>
        <span class="n">hexag</span> <span class="o">=</span>  <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fh</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>
        <span class="n">squareS</span> <span class="o">=</span>  <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">quadFacesS</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">qVertS</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">FsS</span><span class="p">,</span><span class="mf">4.5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>
        <span class="n">hexagS</span> <span class="o">=</span>  <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFacesS</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVertS</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">FhS</span><span class="p">,</span><span class="mf">6.5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>
     
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;squ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">square</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;hex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hexag</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;squ_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">squareS</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;hex_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hexagS</span>
        <span class="c1"># ... &#39;special case&#39; only for fev method for polar surfaces.</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;squ_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;hex_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>

        <span class="k">return</span> <span class="n">surfacesDictionary</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_midVectorFun</span><span class="p">(</span><span class="n">vectA</span><span class="p">,</span> <span class="n">vectB</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Mid-point at the mid radial position between two points in a plane.&quot;&quot;&quot;</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vectA</span><span class="p">,</span><span class="n">vectB</span><span class="p">)</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="n">mid</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vectA</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vectB</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mid</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_map3Dto2Dsquare</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Override map surface to rectagular unit coordinates (0,1).&quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">theta</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">theta</span> <span class="p">,</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">theta</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">r</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span> 
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span> 
        <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>

<div class="viewcode-block" id="PolarSurface.coor_convert"><a class="viewcode-back" href="../../docs/clss_mod/surface.polar.html#s3dlib.surface.PolarSurface.coor_convert">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coor_convert</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">tocart</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override coordinate transformation.</span>

<span class="sd">        Tranformation between polar and Cartesian coordinates.</span>
<span class="sd">        The angular coordinate is in radians with domain 0 to 2pi.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xyz : 3xN array</span>
<span class="sd">            N number of vectors in either polar or cartesian coordinates,</span>
<span class="sd">            including the z coordinate( which remains unchanged).</span>

<span class="sd">        tocart : { True, False }, default: False</span>
<span class="sd">            If True, input is polar and output is cartesian.</span>
<span class="sd">            If False, input is cartesian and output is polar.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list: 3xN array</span>
<span class="sd">            Vector of N transformed coordinates. </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">tocart</span> <span class="p">:</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">abc</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">theta</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">theta</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">abc</span> <span class="o">=</span> <span class="p">[</span><span class="n">R</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">z</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">abc</span></div>

    <span class="n">_base_surfaces</span> <span class="o">=</span> <span class="n">_get_polar_surfaces_dictionary</span><span class="o">.</span><span class="vm">__func__</span><span class="p">()</span>
    <span class="n">_default_base</span> <span class="o">=</span> <span class="s1">&#39;hex&#39;</span>  <span class="c1"># default assignment is indicated in __init Docstring.</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_uvw_to_xyz</span><span class="p">(</span> <span class="bp">cls</span><span class="p">,</span><span class="n">uvw</span><span class="p">,</span> <span class="n">rtz</span><span class="p">)</span> <span class="p">:</span>  
        <span class="sd">&quot;&quot;&quot;Override rotational transformation at a polar coordinate.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_disp_to_xyz</span><span class="p">(</span> <span class="n">uvw</span><span class="p">,</span> <span class="n">rtz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>

<div class="viewcode-block" id="PolarSurface.fev"><a class="viewcode-back" href="../../docs/clss_mod/surface.polar.html#s3dlib.surface.PolarSurface.fev">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fev</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">rez</span><span class="p">,</span> <span class="n">basetype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates number of faces, edges, and vertices of a PolarSurface.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rez : integer</span>
<span class="sd">            Number of recursive subdivisions of a triangulated base faces.</span>
<span class="sd">        </span>
<span class="sd">        basetype : string</span>
<span class="sd">            Starting surface geometries from which the surface would be</span>
<span class="sd">            constructed using recursive subdivisions of the triangular faces.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list: the number of faces, edges, and vertices.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fev</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">basetype</span><span class="p">,</span><span class="bp">cls</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_flat_split_cyclinder</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">basetype</span><span class="p">,</span><span class="n">minrad</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transform cylindrical base surface to polar coordinates. </span>

<span class="sd">        note :  This method provides an alternative to the </span>
<span class="sd">                poler basetypes of &#39;hex_s&#39; and &#39;squ_s&#39;.</span>
<span class="sd">                The grids constructed here may provide smoother</span>
<span class="sd">                geometries depending on the mapping functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># .................................................</span>
        <span class="k">def</span> <span class="nf">cyl2pol</span><span class="p">(</span><span class="n">rtz</span><span class="p">):</span>
            <span class="n">r</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">rtz</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">minrad</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
            <span class="n">m</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">minrad</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">b</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="n">z</span>
            <span class="k">return</span> <span class="n">R</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">Z</span>
        <span class="c1"># .................................................</span>
        <span class="k">if</span> <span class="n">basetype</span> <span class="ow">is</span> <span class="s1">&#39;squ_c&#39;</span> <span class="p">:</span> <span class="n">cylbase</span> <span class="o">=</span> <span class="s1">&#39;squ_s&#39;</span> 
        <span class="k">if</span> <span class="n">basetype</span> <span class="ow">is</span> <span class="s1">&#39;hex_c&#39;</span> <span class="p">:</span> <span class="n">cylbase</span> <span class="o">=</span> <span class="s1">&#39;tri_s&#39;</span>
        <span class="n">cyl_obj</span> <span class="o">=</span> <span class="n">CylindricalSurface</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">cylbase</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">map_geom_from_op</span><span class="p">(</span><span class="n">cyl2pol</span><span class="p">)</span>
        <span class="n">baseFaceVertexIndices</span> <span class="o">=</span> <span class="n">cyl_obj</span><span class="o">.</span><span class="n">_base_surfaces</span><span class="p">[</span><span class="n">cylbase</span><span class="p">]</span> <span class="p">[</span><span class="s1">&#39;baseFaceIndices&#39;</span><span class="p">]</span>    
        <span class="n">fvIndices</span> <span class="o">=</span> <span class="n">cyl_obj</span><span class="o">.</span><span class="n">fvIndices</span>
        <span class="n">vertexCoor</span> <span class="o">=</span> <span class="n">cyl_obj</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="n">evIndices</span> <span class="o">=</span> <span class="n">cyl_obj</span><span class="o">.</span><span class="n">evIndices</span>
        <span class="k">return</span> <span class="n">vertexCoor</span><span class="p">,</span> <span class="n">fvIndices</span><span class="p">,</span> <span class="n">evIndices</span><span class="p">,</span> <span class="n">baseFaceVertexIndices</span><span class="p">,</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rez</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">basetype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minrad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create flat disk surface of unit radius.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rez : integer, optional, default: 0</span>
<span class="sd">            Number of recursive subdivisions of the triangulated base faces.</span>
<span class="sd">            Rez values range from 0 to 7.</span>
<span class="sd">            </span>
<span class="sd">        basetype : {&#39;squ&#39;,&#39;hex&#39;,&#39;squ_s&#39;,&#39;hex_s&#39;,&#39;squ_c&#39;,&#39;hex_c&#39;}, optional, default: &#39;hex&#39;</span>
<span class="sd">            Starting surface geometries from which the surface is</span>
<span class="sd">            constructed using recursive subdivisions of the triangular faces.</span>

<span class="sd">        minrad : scalar, optional, default: 0.01</span>
<span class="sd">            For basetypes &#39;squ_c&#39; and &#39;hex_c, the minimum</span>
<span class="sd">            distance from the z-axis of any vertex coordinate.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If rez is not an integer in range 0 to 7.</span>
<span class="sd">            If basetype is not recognized for this surface constructor.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        *args, **kwargs</span>
<span class="sd">            All other parameters are passed on to &#39;s3dlib.surface.Surface3DCollection&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">minrad</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">minrad</span> <span class="o">=</span> <span class="n">_MINRAD</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrect rez type, must ba of type int&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rez</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">rez</span><span class="o">&gt;</span><span class="n">_MAXREZ</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrest rez of </span><span class="si">{}</span><span class="s1">, must be an int, 0 &lt;= rez &lt;= </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">_MAXREZ</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">basetype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">basetype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_base</span>
        <span class="c1"># ... check for &#39;special case&#39; (ugly code but needed)</span>
        <span class="k">if</span> <span class="n">basetype</span> <span class="ow">is</span> <span class="s1">&#39;squ_c&#39;</span> <span class="ow">or</span> <span class="n">basetype</span> <span class="ow">is</span> <span class="s1">&#39;hex_c&#39;</span> <span class="p">:</span>
            <span class="n">vertexCoor</span><span class="p">,</span> <span class="n">faceIndices</span><span class="p">,</span> <span class="n">edgeIndices</span><span class="p">,</span> <span class="n">bfvi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flat_split_cyclinder</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">basetype</span><span class="p">,</span><span class="n">minrad</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">baseFaceVertexIndices</span> <span class="o">=</span> <span class="n">bfvi</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">basetype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_surfaces</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Basetype </span><span class="si">{}</span><span class="s1"> is not recognized. Possible values are: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">basetype</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_surfaces</span><span class="p">)))</span>
            <span class="n">baseSurfObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_surfaces</span><span class="p">[</span><span class="n">basetype</span><span class="p">]</span>
            <span class="n">baseVcoor</span> <span class="o">=</span> <span class="n">baseSurfObj</span><span class="p">[</span><span class="s1">&#39;baseVerticesCoor&#39;</span><span class="p">]</span>
            <span class="n">baseFaceVertexIndices</span> <span class="o">=</span><span class="n">baseSurfObj</span><span class="p">[</span><span class="s1">&#39;baseFaceIndices&#39;</span><span class="p">]</span>
            <span class="n">indexObj</span><span class="p">,</span><span class="n">vertexCoor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangulateBase</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">baseVcoor</span><span class="p">,</span><span class="n">baseFaceVertexIndices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_midVectorFun</span><span class="p">)</span>
            <span class="n">faceIndices</span> <span class="o">=</span> <span class="n">indexObj</span><span class="p">[</span><span class="s1">&#39;face&#39;</span><span class="p">]</span>
            <span class="n">edgeIndices</span> <span class="o">=</span> <span class="n">indexObj</span><span class="p">[</span><span class="s1">&#39;edge&#39;</span><span class="p">]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">vertexCoor</span><span class="p">,</span> <span class="n">faceIndices</span><span class="p">,</span> <span class="n">edgeIndices</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_normal_scale</span> <span class="o">=</span> <span class="n">_normLength</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">faceIndices</span><span class="p">),</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.55</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rez</span> <span class="o">=</span> <span class="n">rez</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_basetype</span> <span class="o">=</span> <span class="n">basetype</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="CylindricalSurface"><a class="viewcode-back" href="../../docs/clss_mod/surface.cyl.html#s3dlib.surface.CylindricalSurface">[docs]</a><span class="k">class</span> <span class="nc">CylindricalSurface</span><span class="p">(</span><span class="n">Surface3DCollection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cylindrical 3D surface in cylindrical coordinates.</span>

<span class="sd">    Methods are inherited from the Surface3DCollection.</span>
<span class="sd">    Cylindrical surface geometries are created in this subclass.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_cylindrical_surfaces_dictionary</span><span class="p">()</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Constructs the dictionary of base cylindrical surface geometries. &quot;&quot;&quot;</span>

        <span class="n">surfacesDictionary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">def</span> <span class="nf">construct_tricylinder</span><span class="p">()</span> <span class="p">:</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="mf">0.5</span>   
            <span class="n">baseVert</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseFaces</span><span class="o">=</span><span class="p">(</span> 
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> 
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span>

            <span class="n">Fo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFaces</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fo</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">}</span>

        <span class="k">def</span> <span class="nf">construct_tri2cylinder</span><span class="p">()</span> <span class="p">:</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="mf">0.5</span>   
            <span class="n">baseVert</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseFaces</span><span class="o">=</span><span class="p">(</span> 
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>

            <span class="n">Fo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFaces</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fo</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">}</span>

        <span class="k">def</span> <span class="nf">construct_tri2cylinder_sliced</span><span class="p">()</span> <span class="p">:</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="mf">0.5</span>   
            <span class="n">baseVert</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">yof</span> <span class="o">=</span> <span class="mf">0.0001</span>

            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">yof</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">yof</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="n">yof</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="n">yof</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            
            <span class="n">baseFaces</span><span class="o">=</span><span class="p">(</span> 
            <span class="c1">#    [0,4,5],[1,3,4],[2,5,3],</span>
            <span class="c1">#    [0,8,7],[1,7,6],[2,6,8],</span>
            <span class="c1">#    [0,7,4],[1,6,3],[2,8,5],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>

                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>

            <span class="n">Fo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFaces</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fo</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>

        <span class="k">def</span> <span class="nf">construct_quadcylinder</span><span class="p">()</span> <span class="p">:</span>
            <span class="n">xy0</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
            <span class="n">baseVert</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">xy0</span><span class="p">,</span><span class="n">xy0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="n">xy0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">xy0</span><span class="p">,</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">xy0</span><span class="p">,</span><span class="n">xy0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="n">xy0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">xy0</span><span class="p">,</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">baseFaces</span><span class="o">=</span><span class="p">(</span> 
                <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">]</span> <span class="p">)</span>

            <span class="n">Fo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFaces</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fo</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">}</span>

        <span class="k">def</span> <span class="nf">construct_quad2cylinder</span><span class="p">()</span> <span class="p">:</span>
            <span class="n">xy0</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
            <span class="n">baseVert</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">xy0</span><span class="p">,</span><span class="n">xy0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="n">xy0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">xy0</span><span class="p">,</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>


            <span class="n">baseFaces</span><span class="o">=</span><span class="p">(</span> 
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="p">)</span>

            <span class="n">Fo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFaces</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fo</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">}</span>

        <span class="k">def</span> <span class="nf">construct_quad2cylinder_sliced</span><span class="p">()</span> <span class="p">:</span>
            <span class="n">xy0</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
            <span class="n">baseVert</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">xy0</span><span class="p">,</span><span class="n">xy0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="n">xy0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">xy0</span><span class="p">,</span><span class="o">-</span><span class="n">xy0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">yof</span> <span class="o">=</span> <span class="mf">0.0001</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">yof</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">yof</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="n">yof</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="n">yof</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">baseFaces</span><span class="o">=</span><span class="p">(</span> 
            <span class="c1">#    [0,7,4],[1,6,7],[2,5,6],[3,4,5],</span>
            <span class="c1">#    [0,8,11],[1,11,10],[2,10,9],[3,9,8],</span>
            <span class="c1">#    [0,4,8],[1,7,11],[2,6,10],[3,5,9],</span>
            <span class="c1">#    [0,11,7],[1,10,6],[2,9,5],[3,8,4] )</span>

                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">13</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span> <span class="p">)</span>


            <span class="n">Fo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFaces</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fo</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>

        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;tri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">construct_tricylinder</span><span class="p">()</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;squ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">construct_quadcylinder</span><span class="p">()</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;tri2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">construct_tri2cylinder</span><span class="p">()</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;squ2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">construct_quad2cylinder</span><span class="p">()</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;tri_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">construct_tri2cylinder_sliced</span><span class="p">()</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;squ_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">construct_quad2cylinder_sliced</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">surfacesDictionary</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_midVectorFun</span><span class="p">(</span><span class="n">vectA</span><span class="p">,</span> <span class="n">vectB</span><span class="p">)</span> <span class="p">:</span>  
        <span class="sd">&quot;&quot;&quot;Mid-point between two points on a unit cylinder.&quot;&quot;&quot;</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vectA</span><span class="p">,</span><span class="n">vectB</span><span class="p">)</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="n">mid</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mid</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">mid</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">z</span><span class="p">])</span>
        <span class="n">xy</span> <span class="o">=</span>  <span class="n">v</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">xy</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">z</span><span class="p">])</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_map3Dto2Dsquare</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Override map surface to rectagular unit coordinates (0,1).&quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">theta</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">theta</span> <span class="p">,</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">theta</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span>  <span class="n">z</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.5</span> 
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span> 
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span> 
        <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>

<div class="viewcode-block" id="CylindricalSurface.coor_convert"><a class="viewcode-back" href="../../docs/clss_mod/surface.cyl.html#s3dlib.surface.CylindricalSurface.coor_convert">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coor_convert</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">tocart</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override coordinate transformation.</span>

<span class="sd">        Tranformation between cylindrical and Cartesian coordinates.</span>
<span class="sd">        The angular coordinate is in radians with domain 0 to 2pi.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xyz : 3xN</span>
<span class="sd">            N number of vectors in either cylindrical or cartesian coordinates,</span>
<span class="sd">            including the z coordinate( which remains unchanged).</span>

<span class="sd">        tocart : { True, False }, default: False</span>
<span class="sd">            If True, input is cylindrical and output is cartesian.</span>
<span class="sd">            If False, input is cartesian and output is cylindrical.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list: 3xN array</span>
<span class="sd">            Vector of N transformed coordinates. </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">tocart</span> <span class="p">:</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">abc</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">theta</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">theta</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">abc</span> <span class="o">=</span> <span class="p">[</span><span class="n">R</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">z</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">abc</span></div>

    <span class="n">_base_surfaces</span> <span class="o">=</span> <span class="n">_get_cylindrical_surfaces_dictionary</span><span class="o">.</span><span class="vm">__func__</span><span class="p">()</span>
    <span class="n">_default_base</span> <span class="o">=</span> <span class="s1">&#39;tri&#39;</span>  <span class="c1"># default assignment is indicated in __init Docstring.</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_uvw_to_xyz</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">uvw</span><span class="p">,</span> <span class="n">rtz</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Override rotational tranformation at a cylindrical coordinate.&quot;&quot;&quot;</span> 
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_disp_to_xyz</span><span class="p">(</span> <span class="n">uvw</span><span class="p">,</span> <span class="n">rtz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span> <span class="p">)</span>

<div class="viewcode-block" id="CylindricalSurface.fev"><a class="viewcode-back" href="../../docs/clss_mod/surface.cyl.html#s3dlib.surface.CylindricalSurface.fev">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fev</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">rez</span><span class="p">,</span> <span class="n">basetype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates number of faces, edges, and vertices of a CylindricalSurface.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rez : integer</span>
<span class="sd">            Number of recursive subdivisions of a triangulated base faces.</span>
<span class="sd">        </span>
<span class="sd">        basetype : string</span>
<span class="sd">            Starting surface geometries from which the surface would be</span>
<span class="sd">            constructed using recursive subdivisions of the triangular faces.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list: the number of faces, edges, and vertices.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fev</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">basetype</span><span class="p">,</span><span class="bp">cls</span><span class="p">)</span></div>
               
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rez</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">basetype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create cylindrical surface of unit radius and length 2.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rez : integer, optional, default: 0</span>
<span class="sd">            Number of recursive subdivisions of the triangulated base faces.</span>
<span class="sd">            Rez values range from 0 to 7.</span>
<span class="sd">            </span>
<span class="sd">        basetype : {&#39;tri&#39;,&#39;squ&#39;,&#39;tri2&#39;,&#39;squ2&#39;}, optional, default: &#39;tri&#39;</span>
<span class="sd">            Starting surface geometries from which the surface is</span>
<span class="sd">            constructed using recursive subdivisions of the triangular faces.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If rez is not an integer in range 0 to 7.</span>
<span class="sd">            If basetype is not recognized for this surface constructor.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        *args, **kwargs</span>
<span class="sd">            All other parameters are passed on to &#39;s3dlib.surface.Surface3DCollection&#39;.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrect rez type, must ba of type int&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rez</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">rez</span><span class="o">&gt;</span><span class="n">_MAXREZ</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrest rez of </span><span class="si">{}</span><span class="s1">, must be an int, 0 &lt;= rez &lt;= </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">_MAXREZ</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">basetype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">basetype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_base</span>
        <span class="k">if</span> <span class="n">basetype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_surfaces</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Basetype </span><span class="si">{}</span><span class="s1"> is not recognized. Possible values are: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">basetype</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_surfaces</span><span class="p">)))</span>
        <span class="n">baseSurfObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_surfaces</span><span class="p">[</span><span class="n">basetype</span><span class="p">]</span>
        <span class="n">baseVcoor</span> <span class="o">=</span> <span class="n">baseSurfObj</span><span class="p">[</span><span class="s1">&#39;baseVerticesCoor&#39;</span><span class="p">]</span>
        <span class="n">baseFaceVertexIndices</span> <span class="o">=</span><span class="n">baseSurfObj</span><span class="p">[</span><span class="s1">&#39;baseFaceIndices&#39;</span><span class="p">]</span>
        <span class="n">indexObj</span><span class="p">,</span><span class="n">vertexCoor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangulateBase</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">baseVcoor</span><span class="p">,</span><span class="n">baseFaceVertexIndices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_midVectorFun</span><span class="p">)</span>
        <span class="n">faceIndices</span> <span class="o">=</span> <span class="n">indexObj</span><span class="p">[</span><span class="s1">&#39;face&#39;</span><span class="p">]</span>
        <span class="n">edgeIndices</span> <span class="o">=</span> <span class="n">indexObj</span><span class="p">[</span><span class="s1">&#39;edge&#39;</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">vertexCoor</span><span class="p">,</span> <span class="n">faceIndices</span><span class="p">,</span> <span class="n">edgeIndices</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_normal_scale</span> <span class="o">=</span>  <span class="n">_normLength</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">faceIndices</span><span class="p">),</span> <span class="mf">1.14</span><span class="p">,</span> <span class="mf">1.31</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rez</span> <span class="o">=</span> <span class="n">rez</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_basetype</span> <span class="o">=</span> <span class="n">basetype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_Vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SphericalSurface"><a class="viewcode-back" href="../../docs/clss_mod/surface.sph.html#s3dlib.surface.SphericalSurface">[docs]</a><span class="k">class</span> <span class="nc">SphericalSurface</span><span class="p">(</span><span class="n">Surface3DCollection</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spherical 3D surface in spherical coordinates.</span>

<span class="sd">    Methods are inherited from the Surface3DCollection.</span>
<span class="sd">    Spherical surface geometries are created in this subclass.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SphericalSurface.get_dodecahedron"><a class="viewcode-back" href="../../docs/clss_mod/surface.sph.html#s3dlib.surface.SphericalSurface.get_dodecahedron">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_dodecahedron</span><span class="p">()</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Numpy arrays of dodecahedron vertices (20,3) and face vertex indices (12,5).&quot;&quot;&quot;</span>
        
        <span class="n">v</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">SphericalSurface</span><span class="o">.</span><span class="n">_get_platonic_solids_dictionary</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_platonic_solids_dictionary</span><span class="p">(</span><span class="n">getArrays</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Constructs the dictionary of base spherical surface geometries.&quot;&quot;&quot;</span>
        <span class="c1"># ....................................................</span>
        <span class="k">def</span> <span class="nf">get_dodecahedron</span><span class="p">()</span> <span class="p">:</span>
            
            <span class="n">zeta</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span>
            <span class="n">ksi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
            <span class="n">lam_squ</span> <span class="o">=</span> <span class="mi">8</span><span class="o">/</span><span class="mi">9</span>
            <span class="n">hEdge_squ</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ksi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

            <span class="n">Ax</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span>
            <span class="n">Apx</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span>
            <span class="n">Bx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lam_squ</span><span class="o">-</span><span class="n">hEdge_squ</span><span class="p">)</span>
            <span class="n">Cx</span> <span class="o">=</span> <span class="n">ksi</span> 
            <span class="n">Dx</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">Bx</span>
            
            <span class="n">Apy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
            <span class="n">By</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">hEdge_squ</span><span class="p">)</span>
            <span class="n">Cy</span> <span class="o">=</span> <span class="n">Apy</span>
            <span class="n">Dy</span> <span class="o">=</span> <span class="n">By</span> <span class="o">+</span> <span class="n">Cy</span>

            <span class="c1"># -----------------------</span>

            <span class="n">docTop</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="n">Ax</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ksi</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">Apx</span><span class="p">,</span> <span class="n">Apy</span><span class="p">,</span> <span class="n">ksi</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">Apx</span><span class="p">,</span> <span class="o">-</span><span class="n">Apy</span><span class="p">,</span> <span class="n">ksi</span><span class="p">],</span>
                <span class="p">[</span><span class="n">Cx</span><span class="p">,</span> <span class="n">Cy</span><span class="p">,</span> <span class="n">zeta</span><span class="p">],</span> <span class="p">[</span><span class="n">Dx</span><span class="p">,</span> <span class="n">Dy</span><span class="p">,</span> <span class="n">zeta</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">zeta</span><span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="n">Bx</span><span class="p">,</span> <span class="o">-</span><span class="n">By</span><span class="p">,</span> <span class="n">zeta</span><span class="p">],</span> <span class="p">[</span><span class="n">Dx</span><span class="p">,</span> <span class="o">-</span><span class="n">Dy</span><span class="p">,</span> <span class="n">zeta</span><span class="p">],</span> <span class="p">[</span><span class="n">Cx</span><span class="p">,</span> <span class="o">-</span><span class="n">Cy</span><span class="p">,</span> <span class="n">zeta</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="n">docBottom</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ver</span> <span class="ow">in</span> <span class="n">docTop</span> <span class="p">:</span> <span class="n">docBottom</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">ver</span><span class="p">,[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="p">)</span>
            <span class="n">docbaseVert</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">docTop</span><span class="p">,</span><span class="n">docBottom</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="n">docbaseFaces</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">13</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">11</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">14</span><span class="p">],[</span><span class="mi">13</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">18</span><span class="p">],[</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">16</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="k">return</span> <span class="n">docbaseVert</span><span class="p">,</span> <span class="n">docbaseFaces</span>
        <span class="k">def</span> <span class="nf">construct_tetrahedron</span><span class="p">()</span> <span class="p">:</span>
            <span class="n">cSqr</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">zeta</span> <span class="o">=</span> <span class="p">(</span><span class="n">cSqr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">cSqr</span><span class="p">)</span>
            <span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">cSqr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cSqr</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">cSqr</span><span class="p">)</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">chi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">chi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        
            <span class="n">baseVert</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">chi</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">zeta</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="o">-</span><span class="n">zeta</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="o">-</span><span class="n">zeta</span><span class="p">])</span>

            <span class="n">baseFaces</span><span class="o">=</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

            <span class="n">Fo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFaces</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fo</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="p">}</span>
        <span class="k">def</span> <span class="nf">construct_cube</span><span class="p">()</span> <span class="p">:</span>
            <span class="n">zeta</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">x0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">chi</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">x0</span>
        
            <span class="n">cubeBaseVert</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">chi</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">zeta</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">zeta</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="n">zeta</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">chi</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">zeta</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="o">-</span><span class="n">zeta</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="o">-</span><span class="n">zeta</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">cubeBaseFaces</span><span class="o">=</span><span class="p">(</span> 
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="p">)</span>
            
            <span class="n">baseFaces</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">baseVert</span> <span class="o">=</span> <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">cubeBaseFaces</span> <span class="p">:</span>
                <span class="n">vcSum</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># get square face center</span>
                <span class="k">for</span> <span class="n">vI</span> <span class="ow">in</span> <span class="n">face</span> <span class="p">:</span> <span class="n">vcSum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vcSum</span><span class="p">,</span><span class="n">cubeBaseVert</span><span class="p">[</span><span class="n">vI</span><span class="p">])</span>
                <span class="n">vcSum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">vcSum</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">vcCenter</span> <span class="o">=</span> <span class="n">vcSum</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vcSum</span><span class="p">)</span>
                <span class="n">vIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseVert</span><span class="p">)</span>
                <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vcCenter</span><span class="p">)</span>
                <span class="c1"># subdivide cube face into 4 triangles</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">newFace</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">newFace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vIndex</span><span class="p">)</span>
                    <span class="n">newFace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">newFace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="p">[</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">4</span><span class="p">])</span>
                    <span class="n">baseFaces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newFace</span><span class="p">)</span>

            <span class="n">Fo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFaces</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fo</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="p">}</span>
        <span class="k">def</span> <span class="nf">construct_cubeS</span><span class="p">()</span> <span class="p">:</span>
            <span class="n">zeta</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">x0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">chi</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">x0</span>

            <span class="n">soff</span> <span class="o">=</span> <span class="mf">0.01</span>
            <span class="n">x0S</span><span class="p">,</span> <span class="n">y0S</span> <span class="o">=</span> <span class="n">soff</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">soff</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">y0S</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">cubeBaseVert</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">chi</span><span class="p">,</span><span class="o">-</span><span class="n">w</span><span class="p">,</span><span class="n">zeta</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">chi</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span><span class="n">zeta</span><span class="p">])</span>

            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">zeta</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="n">zeta</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">chi</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">zeta</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span><span class="o">-</span><span class="n">zeta</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="o">-</span><span class="n">zeta</span><span class="p">])</span>
            
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">soff</span><span class="p">,</span>   <span class="n">w</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>                     
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>  <span class="n">x0S</span><span class="p">,</span> <span class="n">y0S</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="o">-</span><span class="n">x0S</span><span class="p">,</span> <span class="n">y0S</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="o">-</span><span class="n">soff</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="o">-</span><span class="n">x0S</span><span class="p">,</span><span class="o">-</span><span class="n">y0S</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>  <span class="n">x0S</span><span class="p">,</span><span class="o">-</span><span class="n">y0S</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">soff</span><span class="p">,</span>  <span class="o">-</span><span class="n">w</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">soff</span><span class="p">,</span>   <span class="n">w</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>                     
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>  <span class="n">x0S</span><span class="p">,</span> <span class="n">y0S</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="o">-</span><span class="n">x0S</span><span class="p">,</span> <span class="n">y0S</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="o">-</span><span class="n">soff</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="o">-</span><span class="n">x0S</span><span class="p">,</span><span class="o">-</span><span class="n">y0S</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>  <span class="n">x0S</span><span class="p">,</span><span class="o">-</span><span class="n">y0S</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">soff</span><span class="p">,</span>  <span class="o">-</span><span class="n">w</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">cubeBaseFaces</span><span class="o">=</span><span class="p">(</span> 
                <span class="p">[</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="p">[</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="p">[</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span><span class="mi">11</span><span class="p">],</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">13</span><span class="p">],</span> 
                <span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="p">)</span>
            
            <span class="n">baseFaces</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">baseVert</span> <span class="o">=</span> <span class="n">cubeBaseVert</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">cubeBaseFaces</span> <span class="p">:</span>
                <span class="n">vcSum</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># get square face center</span>
                <span class="k">for</span> <span class="n">vI</span> <span class="ow">in</span> <span class="n">face</span> <span class="p">:</span> <span class="n">vcSum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vcSum</span><span class="p">,</span><span class="n">cubeBaseVert</span><span class="p">[</span><span class="n">vI</span><span class="p">])</span>
                <span class="n">vcSum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">vcSum</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">vcCenter</span> <span class="o">=</span> <span class="n">vcSum</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vcSum</span><span class="p">)</span>
                <span class="n">vIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseVert</span><span class="p">)</span>
                <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vcCenter</span><span class="p">)</span>
                <span class="c1"># subdivide cube face into 4 triangles</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">newFace</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">newFace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vIndex</span><span class="p">)</span>
                    <span class="n">newFace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">newFace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="p">[</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">4</span><span class="p">])</span>
                    <span class="n">baseFaces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newFace</span><span class="p">)</span>

            <span class="n">Fo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFaces</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fo</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>
        <span class="k">def</span> <span class="nf">construct_octahedron</span><span class="p">():</span>
            <span class="n">baseVert</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">baseFaces</span><span class="o">=</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>

            <span class="n">Fo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFaces</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fo</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="p">}</span>
        <span class="k">def</span> <span class="nf">construct_octahedronS</span><span class="p">():</span>
            <span class="n">soff</span> <span class="o">=</span> <span class="mf">0.01</span>

            <span class="n">baseVertS</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">x0S</span><span class="p">,</span> <span class="n">y0S</span> <span class="o">=</span> <span class="n">soff</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">),</span> <span class="n">soff</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
            <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="n">y0S</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">y0S</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x0S</span><span class="p">,</span>  <span class="n">y0S</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0S</span><span class="p">,</span>  <span class="n">y0S</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0S</span><span class="p">,</span> <span class="o">-</span><span class="n">y0S</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x0S</span><span class="p">,</span> <span class="o">-</span><span class="n">y0S</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

            <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x0S</span><span class="p">,</span>  <span class="n">y0S</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0S</span><span class="p">,</span>  <span class="n">y0S</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">x0S</span><span class="p">,</span> <span class="o">-</span><span class="n">y0S</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">baseVertS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span> <span class="n">x0S</span><span class="p">,</span> <span class="o">-</span><span class="n">y0S</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">baseFacesS</span><span class="o">=</span><span class="p">(</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                         <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span>
                         <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
                         <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span> <span class="p">)</span>

            <span class="n">FoS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFacesS</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFacesS</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVertS</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">FoS</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>
        <span class="k">def</span> <span class="nf">construct_dodecahedron</span><span class="p">()</span> <span class="p">:</span>
            <span class="n">docbaseVert</span><span class="p">,</span> <span class="n">docbaseFaces</span> <span class="o">=</span> <span class="n">get_dodecahedron</span><span class="p">()</span>
            <span class="n">baseFaces</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">baseVert</span> <span class="o">=</span> <span class="n">docbaseVert</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            
            <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">docbaseFaces</span> <span class="p">:</span>
                <span class="n">vcSum</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># get pentagon face center</span>
                <span class="k">for</span> <span class="n">vI</span> <span class="ow">in</span> <span class="n">face</span> <span class="p">:</span> <span class="n">vcSum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vcSum</span><span class="p">,</span><span class="n">docbaseVert</span><span class="p">[</span><span class="n">vI</span><span class="p">])</span>
                <span class="n">vcSum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">vcSum</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">vcCenter</span> <span class="o">=</span> <span class="n">vcSum</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vcSum</span><span class="p">)</span>
                <span class="n">vIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseVert</span><span class="p">)</span>
                <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vcCenter</span><span class="p">)</span>
                <span class="c1"># subdivide pentagon face into 5 triangles</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">newFace</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">newFace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vIndex</span><span class="p">)</span>
                    <span class="n">newFace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">newFace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="p">[</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">5</span><span class="p">])</span>
                    <span class="n">baseFaces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newFace</span><span class="p">)</span>

            <span class="n">Fo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFaces</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fo</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="p">}</span>
        <span class="k">def</span> <span class="nf">construct_icosahedron</span><span class="p">():</span>
            <span class="n">cSqr</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">5</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">5</span><span class="p">))</span>
            <span class="n">zeta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">cSqr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">cSqr</span><span class="p">)</span>
            <span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">cSqr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cSqr</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">cSqr</span><span class="p">)</span>
            <span class="n">thetaInc</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">5</span>
            <span class="n">thetaOff</span> <span class="o">=</span> <span class="n">thetaInc</span><span class="o">/</span><span class="mi">2</span>

            <span class="n">baseVert</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">thetaInc</span>
                <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span> <span class="n">chi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">chi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">zeta</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">thetaOff</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">thetaInc</span>
                <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span> <span class="n">chi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">chi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="o">-</span><span class="n">zeta</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">baseVert</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">baseFaces</span><span class="o">=</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>

            <span class="n">Fo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseFaces</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;baseFaceIndices&#39;</span> <span class="p">:</span> <span class="n">baseFaces</span> <span class="p">,</span> <span class="s1">&#39;baseVerticesCoor&#39;</span> <span class="p">:</span> <span class="n">baseVert</span><span class="p">,</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">Fo</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="p">}</span>
        <span class="c1"># ....................................................</span>
        <span class="k">if</span> <span class="n">getArrays</span> <span class="p">:</span> <span class="k">return</span> <span class="n">get_dodecahedron</span><span class="p">()</span>
        <span class="n">surfacesDictionary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;tetra&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">construct_tetrahedron</span><span class="p">()</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;cube&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">construct_cube</span><span class="p">()</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;cube_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">construct_cubeS</span><span class="p">()</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;octa&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">construct_octahedron</span><span class="p">()</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;octa_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">construct_octahedronS</span><span class="p">()</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;dodeca&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">construct_dodecahedron</span><span class="p">()</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;icosa&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">construct_icosahedron</span><span class="p">()</span>
        <span class="c1"># ... &#39;special case&#39; only for fev method for spherical surfaces.</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;octa_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>
        <span class="n">surfacesDictionary</span><span class="p">[</span><span class="s1">&#39;cube_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fevParam&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">surfacesDictionary</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_midVectorFun</span><span class="p">(</span><span class="n">vectA</span><span class="p">,</span> <span class="n">vectB</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Mid-point between two points on a unit sphere.&quot;&quot;&quot;</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vectA</span><span class="p">,</span><span class="n">vectB</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mid</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_map3Dto2Dsquare</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Override map surface to rectagular unit coordinates (0,1).&quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">t</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">t</span> <span class="p">,</span><span class="n">t</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">theta</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span>  <span class="n">phi</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="mf">0.5</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span> 
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span> 
        <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>

<div class="viewcode-block" id="SphericalSurface.coor_convert"><a class="viewcode-back" href="../../docs/clss_mod/surface.sph.html#s3dlib.surface.SphericalSurface.coor_convert">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coor_convert</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">tocart</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override coordinate transformation.</span>

<span class="sd">        Tranformation between spherical and Cartesian coordinates.</span>
<span class="sd">        The azimuthal coordinate is in radians with domain 0 to 2pi.</span>
<span class="sd">        The polar angle is in radians with domain 0 to pi.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xyz : 3xN array</span>
<span class="sd">            N number of vectors in either spherical or cartesian coordinates,</span>

<span class="sd">        tocart : { True, False }, default: False</span>
<span class="sd">            If True, input is spherical and output is cartesian.</span>
<span class="sd">            If False, input is cartesian and output is spherical.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list: 3xN array</span>
<span class="sd">            Vector of N transformed coordinates. </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">tocart</span> <span class="p">:</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span> <span class="o">=</span> <span class="n">xyz</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">abc</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">z</span><span class="o">*</span><span class="n">z</span> <span class="p">)</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="n">R</span><span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">theta</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">theta</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">abc</span> <span class="o">=</span> <span class="p">[</span><span class="n">R</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">abc</span></div>

    <span class="n">_base_surfaces</span> <span class="o">=</span> <span class="n">_get_platonic_solids_dictionary</span><span class="o">.</span><span class="vm">__func__</span><span class="p">()</span>
    <span class="n">_default_base</span> <span class="o">=</span> <span class="s1">&#39;icosa&#39;</span>  <span class="c1"># default assignment is indicated in __init Docstring.</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_uvw_to_xyz</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">uvw</span><span class="p">,</span> <span class="n">rtp</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Override rotational tranformation at a spherical coordinate.&quot;&quot;&quot;</span> 
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_disp_to_xyz</span><span class="p">(</span> <span class="n">uvw</span><span class="p">,</span> <span class="n">rtp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rtp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span>

<div class="viewcode-block" id="SphericalSurface.fev"><a class="viewcode-back" href="../../docs/clss_mod/surface.sph.html#s3dlib.surface.SphericalSurface.fev">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fev</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rez</span><span class="p">,</span> <span class="n">basetype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates number of faces, edges, and vertices of a SphericalSurface.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rez : integer</span>
<span class="sd">            Number of recursive subdivisions of a triangulated base faces.</span>
<span class="sd">        </span>
<span class="sd">        basetype : string</span>
<span class="sd">            Starting surface geometries from which the surface would be</span>
<span class="sd">            constructed using recursive subdivisions of the triangular faces.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list: the number of faces, edges, and vertices.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fev</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">basetype</span><span class="p">,</span><span class="bp">cls</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_spherical_split_cyclinder</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">basetype</span><span class="p">,</span><span class="n">minrad</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transform cylindrical base surface to spherical coordinates. </span>

<span class="sd">        note :  This method provides an alternative to the </span>
<span class="sd">                spherical basetypes of &#39;hex_s&#39; and &#39;square_s&#39;.</span>
<span class="sd">                The grids constructed here may provide smoother</span>
<span class="sd">                geometries depending on the mapping functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># .................................................</span>
        <span class="k">def</span> <span class="nf">cyl2sph</span><span class="p">(</span><span class="n">rtz</span><span class="p">):</span>
            <span class="n">r</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">rtz</span>
            <span class="n">minphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">minrad</span><span class="p">)</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">z</span><span class="o">*</span><span class="n">minphi</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">R</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">Z</span>
        <span class="c1"># .................................................</span>
        <span class="k">if</span> <span class="n">basetype</span> <span class="ow">is</span> <span class="s1">&#39;octa_c&#39;</span> <span class="p">:</span> <span class="n">cylbase</span> <span class="o">=</span> <span class="s1">&#39;squ_s&#39;</span> 
        <span class="k">if</span> <span class="n">basetype</span> <span class="ow">is</span> <span class="s1">&#39;cube_c&#39;</span> <span class="p">:</span>    <span class="n">cylbase</span> <span class="o">=</span> <span class="s1">&#39;tri_s&#39;</span>
        <span class="n">cyl_obj</span> <span class="o">=</span> <span class="n">CylindricalSurface</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">cylbase</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">map_geom_from_op</span><span class="p">(</span><span class="n">cyl2sph</span><span class="p">)</span>
        <span class="n">baseFaceVertexIndices</span> <span class="o">=</span> <span class="n">cyl_obj</span><span class="o">.</span><span class="n">_base_surfaces</span><span class="p">[</span><span class="n">cylbase</span><span class="p">]</span> <span class="p">[</span><span class="s1">&#39;baseFaceIndices&#39;</span><span class="p">]</span>    
        <span class="n">fvIndices</span> <span class="o">=</span> <span class="n">cyl_obj</span><span class="o">.</span><span class="n">fvIndices</span>
        <span class="n">vertexCoor</span> <span class="o">=</span> <span class="n">cyl_obj</span><span class="o">.</span><span class="n">vertexCoor</span>
        <span class="n">evIndices</span> <span class="o">=</span> <span class="n">cyl_obj</span><span class="o">.</span><span class="n">evIndices</span>
        <span class="k">return</span> <span class="n">vertexCoor</span><span class="p">,</span> <span class="n">fvIndices</span><span class="p">,</span> <span class="n">evIndices</span><span class="p">,</span> <span class="n">baseFaceVertexIndices</span><span class="p">,</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rez</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">basetype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minrad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create spherical surface of unit radius.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rez : integer, optional, default: 0</span>
<span class="sd">            Number of recursive subdivisions of the triangulated base faces.</span>
<span class="sd">            Rez values range from 0 to 7.</span>
<span class="sd">            </span>
<span class="sd">        basetype : {&#39;tetra&#39;,&#39;octa&#39;,&#39;icosa&#39;,&#39;cube&#39;,&#39;dodeca&#39;, \</span>
<span class="sd">            &#39;octa_s&#39;,&#39;cube_s&#39;,&#39;octa_c&#39;,&#39;cube_c&#39;}, optional, default: &#39;icosa&#39;</span>
<span class="sd">            Starting surface geometries from which the surface is</span>
<span class="sd">            constructed using recursive subdivisions of the triangular faces.</span>
<span class="sd">            All basetypes are based on the five platonic solids.</span>

<span class="sd">        minrad : scalar, optional, default: 0.01</span>
<span class="sd">            For basetypes &#39;octa_c&#39; and &#39;cube_c, the minimum</span>
<span class="sd">            distance from the z-axis of any vertex coordinate.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If rez is not an integer in range 0 to 7.</span>
<span class="sd">            If basetype is not recognized for this surface constructor.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        *args, **kwargs</span>
<span class="sd">            All other parameters are passed on to &#39;s3dlib.surface.Surface3DCollection&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">minrad</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">minrad</span> <span class="o">=</span> <span class="n">_MINRAD</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrect rez type, must ba of type int&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rez</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">rez</span><span class="o">&gt;</span><span class="n">_MAXREZ</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrest rez of </span><span class="si">{}</span><span class="s1">, must be an int, 0 &lt;= rez &lt;= </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">_MAXREZ</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">basetype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">basetype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_base</span>
        <span class="c1"># ... check for &#39;special case&#39; (ugly code but needed)</span>
        <span class="k">if</span> <span class="n">basetype</span> <span class="ow">is</span> <span class="s1">&#39;octa_c&#39;</span> <span class="ow">or</span> <span class="n">basetype</span> <span class="ow">is</span> <span class="s1">&#39;cube_c&#39;</span> <span class="p">:</span>
            <span class="n">vertexCoor</span><span class="p">,</span> <span class="n">faceIndices</span><span class="p">,</span> <span class="n">edgeIndices</span><span class="p">,</span> <span class="n">bfvi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spherical_split_cyclinder</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">basetype</span><span class="p">,</span><span class="n">minrad</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">baseFaceVertexIndices</span> <span class="o">=</span> <span class="n">bfvi</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">basetype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_surfaces</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Basetype </span><span class="si">{}</span><span class="s1"> is not recognized. Possible values are: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">basetype</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_surfaces</span><span class="p">)))</span>
            <span class="n">baseSurfObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_surfaces</span><span class="p">[</span><span class="n">basetype</span><span class="p">]</span>
            <span class="n">baseVcoor</span> <span class="o">=</span> <span class="n">baseSurfObj</span><span class="p">[</span><span class="s1">&#39;baseVerticesCoor&#39;</span><span class="p">]</span>
            <span class="n">baseFaceVertexIndices</span> <span class="o">=</span><span class="n">baseSurfObj</span><span class="p">[</span><span class="s1">&#39;baseFaceIndices&#39;</span><span class="p">]</span>
            <span class="n">indexObj</span><span class="p">,</span><span class="n">vertexCoor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangulateBase</span><span class="p">(</span><span class="n">rez</span><span class="p">,</span><span class="n">baseVcoor</span><span class="p">,</span><span class="n">baseFaceVertexIndices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_midVectorFun</span><span class="p">)</span>
            <span class="n">faceIndices</span> <span class="o">=</span> <span class="n">indexObj</span><span class="p">[</span><span class="s1">&#39;face&#39;</span><span class="p">]</span>
            <span class="n">edgeIndices</span> <span class="o">=</span> <span class="n">indexObj</span><span class="p">[</span><span class="s1">&#39;edge&#39;</span><span class="p">]</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">vertexCoor</span><span class="p">,</span> <span class="n">faceIndices</span><span class="p">,</span> <span class="n">edgeIndices</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_normal_scale</span> <span class="o">=</span> <span class="n">_normLength</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">faceIndices</span><span class="p">),</span> <span class="mf">0.61</span><span class="p">,</span> <span class="mf">1.52</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rez</span> <span class="o">=</span> <span class="n">rez</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_basetype</span> <span class="o">=</span> <span class="n">basetype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_Vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="Vector3DCollection"><a class="viewcode-back" href="../../docs/clss_mod/surface.vect.html#s3dlib.surface.Vector3DCollection">[docs]</a><span class="k">class</span> <span class="nc">Vector3DCollection</span><span class="p">(</span><span class="n">Line3DCollection</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collection of 3D vectors represented as arrows.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">vect</span> <span class="p">,</span> <span class="n">alr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a collection of 3D vectors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        location : N x 3 float array</span>
<span class="sd">            Cartesian coordinate location (tails) for N number of vectors.</span>

<span class="sd">        vect : N x 3 float array</span>
<span class="sd">            N number of vectors in Cartesian coordinates.</span>

<span class="sd">        alr : scalar, optional, default: 0.25</span>
<span class="sd">            Axis length ratio, head size to vector magnitude.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        *args, **kwargs</span>
<span class="sd">            All other parameters are passed on to mpl_toolkits.mplot3d.art3d.Line3DCollection.</span>
<span class="sd">            Valid keywords include: colors, linewidths.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">alr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">alr</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quiverLines</span><span class="p">(</span><span class="n">location</span><span class="p">,</span><span class="n">vect</span><span class="p">,</span><span class="n">alr</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="c1"># note: each vector representation is composed of 3 lines</span>
        <span class="n">numbVect</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_segments3d</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;:  vectors: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numbVect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_quiverLines</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">vC</span><span class="p">,</span> <span class="n">vN</span><span class="p">,</span> <span class="n">alr</span><span class="p">)</span> <span class="p">:</span>
        <span class="c1"># ..................................................</span>
        <span class="k">def</span> <span class="nf">quiver</span><span class="p">(</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arrow_length_ratio</span><span class="o">=</span><span class="n">alr</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="s1">&#39;tail&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="c1"># taken directly from mpl_toolkits.mplot3d.axes3d source </span>
            <span class="c1"># and removed axis reference.  Acknowledgement:</span>
            <span class="c1"># Copyright (c) 2012-2013 Matplotlib Development Team; All Rights Reserved</span>
            <span class="c1"># ...............................................</span>
            <span class="k">def</span> <span class="nf">calc_arrow</span><span class="p">(</span><span class="n">uvw</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                To calculate the arrow head. uvw should be a unit vector.</span>
<span class="sd">                We normalize it here:</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="c1"># get unit direction vector perpendicular to (u,v,w)</span>
                <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">uvw</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">norm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">uvw</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">uvw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

                <span class="c1"># compute the two arrowhead direction unit vectors</span>
                <span class="n">ra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span>

                <span class="c1"># construct the rotation matrices</span>
                <span class="n">Rpos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">c</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="p">),</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="p">),</span> <span class="n">y</span><span class="o">*</span><span class="n">s</span><span class="p">],</span>
                                <span class="p">[</span><span class="n">y</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="p">),</span> <span class="n">c</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="p">),</span> <span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">s</span><span class="p">],</span>
                                <span class="p">[</span><span class="o">-</span><span class="n">y</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">]])</span>
                <span class="c1"># opposite rotation negates all the sin terms</span>
                <span class="n">Rneg</span> <span class="o">=</span> <span class="n">Rpos</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">Rneg</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> \
                    <span class="o">-</span><span class="n">Rneg</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>

                <span class="c1"># multiply them to get the rotated vector</span>
                <span class="k">return</span> <span class="n">Rpos</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">uvw</span><span class="p">),</span> <span class="n">Rneg</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">uvw</span><span class="p">)</span>
            <span class="c1"># ...............................................</span>
            <span class="n">argi</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">argi</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Wrong number of arguments. Expected </span><span class="si">%d</span><span class="s1"> got </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">argi</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)))</span>
            <span class="n">input_args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[:</span><span class="n">argi</span><span class="p">]</span>
            <span class="n">masks</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">mask</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">input_args</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">)]</span>
            <span class="n">bcast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="o">*</span><span class="n">input_args</span><span class="p">,</span> <span class="o">*</span><span class="n">masks</span><span class="p">)</span>
            <span class="n">input_args</span> <span class="o">=</span> <span class="n">bcast</span><span class="p">[:</span><span class="n">argi</span><span class="p">]</span>
            <span class="n">masks</span> <span class="o">=</span> <span class="n">bcast</span><span class="p">[</span><span class="n">argi</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">masks</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">,</span> <span class="n">masks</span><span class="p">)</span>
                <span class="n">input_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">input_args</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">input_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">input_args</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">input_args</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">shaft_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">])</span>
            <span class="n">arrow_dt</span> <span class="o">=</span> <span class="n">shaft_dt</span> <span class="o">*</span> <span class="n">arrow_length_ratio</span>
            <span class="k">if</span> <span class="n">pivot</span> <span class="o">==</span> <span class="s1">&#39;tail&#39;</span><span class="p">:</span>
                <span class="n">shaft_dt</span> <span class="o">-=</span> <span class="n">length</span>
            <span class="k">elif</span> <span class="n">pivot</span> <span class="o">==</span> <span class="s1">&#39;middle&#39;</span><span class="p">:</span>
                <span class="n">shaft_dt</span> <span class="o">-=</span> <span class="n">length</span><span class="o">/</span><span class="mf">2.</span>
            <span class="k">elif</span> <span class="n">pivot</span> <span class="o">!=</span> <span class="s1">&#39;tip&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid pivot argument: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pivot</span><span class="p">))</span>
            <span class="n">XYZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">input_args</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">UVW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">input_args</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">argi</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">UVW</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">norm</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="n">XYZ</span> <span class="o">=</span> <span class="n">XYZ</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">UVW</span> <span class="o">=</span> <span class="n">UVW</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">UVW</span> <span class="o">=</span> <span class="n">UVW</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">XYZ</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">shafts</span> <span class="o">=</span> <span class="p">(</span><span class="n">XYZ</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">shaft_dt</span><span class="p">,</span> <span class="n">UVW</span><span class="p">))</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">head_dirs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">calc_arrow</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">UVW</span><span class="p">])</span>
                <span class="n">heads</span> <span class="o">=</span> <span class="n">shafts</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">arrow_dt</span><span class="p">,</span> <span class="n">head_dirs</span><span class="p">)</span>
                <span class="n">heads</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrow_dt</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">heads</span> <span class="o">=</span> <span class="n">heads</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">shafts</span><span class="p">,</span> <span class="o">*</span><span class="n">heads</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="n">lines</span>
        <span class="c1"># ..................................................</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">vC</span> <span class="p">)</span>
        <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">vN</span> <span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">quiver</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span></div>




<span class="k">def</span> <span class="nf">_normLength</span><span class="p">(</span> <span class="n">N</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">fac</span><span class="p">,</span> <span class="n">limitarea</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Default face normal vector length.</span>
<span class="sd">    </span>
<span class="sd">    Length proportional to the mean triangulated face edge length.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">limitarea</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">limitarea</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="c1"># aratio - area ratio as a function of the number of faces, N.</span>
    <span class="c1"># heuristic values, exp and fac, are adjustment for small rez surfaces,</span>
    <span class="c1"># with aratio limit to 1 for large N. (continuous smooth surface)</span>
    <span class="n">aratio</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">fac</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="o">-</span><span class="n">exp</span><span class="p">)</span>
    <span class="n">sc</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mf">1.520</span><span class="p">)</span>  <span class="c1"># scale of normalized edge length</span>
    <span class="n">nLen</span> <span class="o">=</span> <span class="n">sc</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">aratio</span><span class="o">*</span><span class="n">limitarea</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nLen</span>

<div class="viewcode-block" id="eulerRot"><a class="viewcode-back" href="../../docs/clss_mod/surface.func.html#s3dlib.surface.eulerRot">[docs]</a><span class="k">def</span> <span class="nf">eulerRot</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">psi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">useXconv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inrad</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Rotation matrix from Euler angles, X or Y convention.&quot;&quot;&quot;</span>
    <span class="c1"># X-convention (zxz&#39;) and Y-convention (zyz&#39;) rotations.</span>
    <span class="n">tht_Rad</span> <span class="o">=</span> <span class="n">theta</span>
    <span class="n">phi_Rad</span> <span class="o">=</span>  <span class="n">phi</span>
    <span class="n">psi_Rad</span> <span class="o">=</span>  <span class="n">psi</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">inrad</span> <span class="p">:</span>
        <span class="n">tht_Rad</span> <span class="o">=</span> <span class="n">theta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span><span class="mf">180.0</span>
        <span class="n">phi_Rad</span> <span class="o">=</span>  <span class="n">phi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span><span class="mf">180.0</span>
        <span class="n">psi_Rad</span> <span class="o">=</span>  <span class="n">psi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span><span class="mf">180.0</span>

    <span class="n">cT</span><span class="p">,</span><span class="n">sT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tht_Rad</span><span class="p">),</span>  <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tht_Rad</span><span class="p">)</span>
    <span class="n">cP</span><span class="p">,</span><span class="n">sP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_Rad</span><span class="p">),</span>  <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_Rad</span><span class="p">)</span>
    <span class="n">cS</span><span class="p">,</span><span class="n">sS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">psi_Rad</span><span class="p">),</span>  <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">psi_Rad</span><span class="p">)</span>
    <span class="n">T_t</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="n">cT</span><span class="p">,</span> <span class="n">sT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">sT</span><span class="p">,</span> <span class="n">cT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">]</span>  <span class="p">]</span>
    <span class="n">T_X</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">0</span> <span class="p">,</span> <span class="n">cP</span><span class="p">,</span> <span class="n">sP</span><span class="p">],</span> <span class="p">[</span> <span class="mi">0</span> <span class="p">,</span><span class="o">-</span><span class="n">sP</span><span class="p">,</span> <span class="n">cP</span><span class="p">]</span>  <span class="p">]</span>
    <span class="n">T_Y</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="n">cP</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="o">-</span><span class="n">sP</span><span class="p">],</span> <span class="p">[</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">],</span> <span class="p">[</span> <span class="n">sP</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="n">cP</span><span class="p">]</span>  <span class="p">]</span>
    <span class="n">T_s</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="n">cS</span><span class="p">,</span> <span class="n">sS</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">sS</span><span class="p">,</span> <span class="n">cS</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">]</span>  <span class="p">]</span>
    <span class="k">if</span> <span class="n">useXconv</span> <span class="p">:</span> <span class="n">T_p</span> <span class="o">=</span> <span class="n">T_X</span>
    <span class="k">else</span><span class="p">:</span>         <span class="n">T_p</span> <span class="o">=</span> <span class="n">T_Y</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span> <span class="n">T_p</span><span class="p">,</span> <span class="n">T_t</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">psi</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span> <span class="n">T_s</span><span class="p">,</span> <span class="n">M</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">M</span></div>

<div class="viewcode-block" id="setupAxis"><a class="viewcode-back" href="../../docs/clss_mod/surface.func.html#s3dlib.surface.setupAxis">[docs]</a><span class="k">def</span> <span class="nf">setupAxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">negaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Set XYZ origin coordinate axis arrows.&quot;&quot;&quot;</span>
    <span class="n">seglength</span> <span class="o">=</span> <span class="n">length</span><span class="o">-</span><span class="n">offset</span>
    <span class="n">endCoor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">seglength</span><span class="p">)</span>
    <span class="n">strCoor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">offset</span><span class="p">)</span>
    <span class="n">alr</span> <span class="o">=</span> <span class="mf">0.2</span><span class="o">/</span><span class="p">(</span><span class="n">seglength</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">strCoor</span> <span class="p">)</span>
    <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">endCoor</span> <span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">,</span> <span class="n">arrow_length_ratio</span><span class="o">=</span><span class="n">alr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">negaxis</span> <span class="p">:</span>
        <span class="n">endCoor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="o">-</span><span class="n">seglength</span><span class="p">)</span>
        <span class="n">strCoor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">strCoor</span> <span class="p">)</span>
        <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">endCoor</span> <span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">,</span> <span class="n">arrow_length_ratio</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">length</span> <span class="o">+</span> <span class="mf">0.15</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="k">return</span>      </div>

<div class="viewcode-block" id="standardAxis"><a class="viewcode-back" href="../../docs/clss_mod/surface.func.html#s3dlib.surface.standardAxis">[docs]</a><span class="k">def</span> <span class="nf">standardAxis</span><span class="p">(</span> <span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span> <span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Set XYZ origin coordinate axis arrows, viewing angle, projection type and clear planes.&quot;&quot;&quot;</span>
    <span class="n">setupAxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
    <span class="n">minmax</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">minmax</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">minmax</span><span class="p">,</span> <span class="n">zlim</span><span class="o">=</span><span class="n">minmax</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_proj_type</span><span class="p">(</span><span class="s1">&#39;ortho&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="rtv"><a class="viewcode-back" href="../../docs/clss_mod/surface.func.html#s3dlib.surface.rtv">[docs]</a><span class="k">def</span> <span class="nf">rtv</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span><span class="n">elev</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">azim</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Transform direction vector &#39;relative to view&#39; axis viewing angles.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">elev</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">elev</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="k">if</span> <span class="n">azim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">azim</span> <span class="o">=</span> <span class="o">-</span><span class="mi">60</span>
    <span class="n">azim_Rad</span> <span class="o">=</span> <span class="n">azim</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span><span class="mf">180.0</span>
    <span class="n">elev_Rad</span> <span class="o">=</span> <span class="n">elev</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span><span class="mf">180.0</span>
    <span class="n">cA</span><span class="p">,</span><span class="n">sA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">azim_Rad</span><span class="p">),</span>  <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">azim_Rad</span><span class="p">)</span>
    <span class="n">cE</span><span class="p">,</span><span class="n">sE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elev_Rad</span><span class="p">),</span>  <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elev_Rad</span><span class="p">)</span>
    <span class="n">TM</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="n">cE</span><span class="o">*</span><span class="n">cA</span><span class="p">,</span> <span class="n">cE</span><span class="o">*</span><span class="n">sA</span><span class="p">,</span> <span class="n">sE</span> <span class="p">],</span>  <span class="p">[</span> <span class="o">-</span><span class="n">sA</span><span class="p">,</span> <span class="n">cA</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>  <span class="p">[</span>  <span class="o">-</span><span class="n">sE</span><span class="o">*</span><span class="n">cA</span><span class="p">,</span> <span class="o">-</span><span class="n">sE</span><span class="o">*</span><span class="n">sA</span><span class="p">,</span> <span class="n">cE</span> <span class="p">]</span> <span class="p">]</span>
    <span class="n">reldir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span><span class="n">TM</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">reldir</span></div>

<div class="viewcode-block" id="elev_azim_2vector"><a class="viewcode-back" href="../../docs/clss_mod/surface.func.html#s3dlib.surface.elev_azim_2vector">[docs]</a><span class="k">def</span> <span class="nf">elev_azim_2vector</span><span class="p">(</span><span class="n">elev</span><span class="p">,</span> <span class="n">azim</span><span class="p">,</span> <span class="n">inrad</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Unit vector in the terms of angular position.&quot;&quot;&quot;</span>
    <span class="n">tht_Rad</span> <span class="o">=</span> <span class="n">azim</span>
    <span class="n">phi_Rad</span> <span class="o">=</span>  <span class="n">elev</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">inrad</span> <span class="p">:</span>
        <span class="n">tht_Rad</span> <span class="o">=</span> <span class="n">azim</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span><span class="mf">180.0</span>
        <span class="n">phi_Rad</span> <span class="o">=</span> <span class="n">elev</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span><span class="mf">180.0</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_Rad</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_Rad</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tht_Rad</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tht_Rad</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../search.html">search</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, frank zaverl.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.
    </div>
  </body>
</html>